{
  "v1_BaoCao_TongHop": "if(@VaiTro = 2) -- lãnh đạo select NhiemVuID, CoQuanXuLyID , IIF(m.SoCongViecChuaPhanCong > 0 or SoCongViec = 0, 1, iif(m.SoCongViecDangXuLy >0, 2, 3)) as TrangThai , IIF(m.SoCongViecQuaHan > 0 , 1, 0) as QuaHan from ( select nv.NhiemVuID, IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID , SUM(IIF(cv.NhiemVuID is not null,1,0)) as SoCongViec , sum(IIF(cv.TrangThaiCongViecID = 1,1,0)) as SoCongViecChuaPhanCong , sum(IIF(cv.TrangThaiCongViecID !=6 and cv.TrangThaiCongViecID != 1,1,0)) as SoCongViecDangXuLy, sum(IIF(cv.TrangThaiCongViecID !=6 and cv.NgayHetHan < GETDATE(),1,0)) as SoCongViecQuaHan from NV_NhiemVu nv join NV_NhiemVu_LanhDaoTheoDoi ldtd on nv.NhiemVuID = ldtd.NhiemVuID left join NV_NhiemVu_CoQuan_CanBo nvcq on nv.NhiemVuID = nvcq.NhiemVuID and nvcq.LoaiPhanCong = 2 left join NV_NhiemVu cv on cv.NhiemVuChaID = nv.NhiemVuID and cv.CoQuanTaoID = IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) where ldtd.LanhDaoTheoDoiID = @CanBoID and nv.NhiemVuChaID is null group by nv.NhiemVuID, nv.LoaiNhiemVu, CoQuanCanBoID, nv.CoQuanTaoID, cv.TrangThaiCongViecID ) m else if(@VaiTro = 3) --- trưởng phòng select NhiemVuID, CoQuanXuLyID , IIF(m.SoCongViecChuaPhanCong > 0 or SoCongViec = 0, 1, iif(m.SoCongViecDangXuLy >0, 2, 3)) as TrangThai , IIF(m.SoCongViecQuaHan > 0 , 1, 0) as QuaHan from ( select nv.NhiemVuID, IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID , SUM(IIF(cv.NhiemVuID is not null,1,0)) as SoCongViec , sum(IIF(cv.TrangThaiCongViecID = 1,1,0)) as SoCongViecChuaPhanCong , sum(IIF(cv.TrangThaiCongViecID !=6 and cv.TrangThaiCongViecID != 1,1,0)) as SoCongViecDangXuLy, sum(IIF(cv.TrangThaiCongViecID !=6 and cv.NgayHetHan < GETDATE(),1,0)) as SoCongViecQuaHan from NV_NhiemVu nv left join NV_NhiemVu_CoQuan_CanBo nvcq on nv.NhiemVuID = nvcq.NhiemVuID and nvcq.LoaiPhanCong = 2 left join NV_NhiemVu cv on cv.NhiemVuChaID = nv.NhiemVuID and cv.CoQuanTaoID = IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) where nv.CoQuanTaoID = @CoQuanID or (nvcq.CoQuanCanBoID = @CoQuanID and nv.LoaiNhiemVu = 2) and nv.NhiemVuChaID is null group by nv.NhiemVuID, nv.LoaiNhiemVu, CoQuanCanBoID, nv.CoQuanTaoID, cv.TrangThaiCongViecID ) m else -- chuyên viên select NhiemVuID, CoQuanXuLyID , IIF(m.SoCongViecChuaPhanCong > 0 or SoCongViec = 0, 1, iif(m.SoCongViecDangXuLy >0, 2, 3)) as TrangThai , IIF(m.SoCongViecQuaHan > 0 , 1, 0) as QuaHan from ( select nv.NhiemVuID, IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID , SUM(IIF(cv.NhiemVuID is not null,1,0)) as SoCongViec , sum(IIF(cv.TrangThaiCongViecID = 1,1,0)) as SoCongViecChuaPhanCong , sum(IIF(cv.TrangThaiCongViecID !=6 and cv.TrangThaiCongViecID != 1,1,0)) as SoCongViecDangXuLy, sum(IIF(cv.TrangThaiCongViecID !=6 and cv.NgayHetHan < GETDATE(),1,0)) as SoCongViecQuaHan from NV_NhiemVu nv left join NV_NhiemVu_CoQuan_CanBo nvcq on nv.NhiemVuID = nvcq.NhiemVuID and nvcq.LoaiPhanCong = 2 left join NV_NhiemVu cv on cv.NhiemVuChaID = nv.NhiemVuID and cv.CoQuanTaoID = IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) left join NV_NhiemVu_CoQuan_CanBo nvcb on nv.NhiemVuID = nvcb.NhiemVuID and nvcb.LoaiPhanCong = 1 where nv.CoQuanTaoID = @CoQuanID or (nvcq.CoQuanCanBoID = @CoQuanID and nv.LoaiNhiemVu = 2) and nv.NhiemVuChaID is null and nvcb.CoQuanCanBoID = @CanBoID group by nv.NhiemVuID, nv.LoaiNhiemVu, nvcq.CoQuanCanBoID, nv.CoQuanTaoID, cv.TrangThaiCongViecID ) m select * from NV_NhiemVu_CoQuan_CanBo select * from NV_NhiemVu where NhiemVuID=42",
  "v1_CanBo_ChucVu_Insert": "insert into  HT_CanBo_ChucVu( ChucVuID, CanBoID ) values( @ChucVuID, @CanBoID )",
  "v1_DanhMuc_ChucVu_Delete": "DELETE FROM  DM_ChucVu WHERE @ChucVuID = ChucVuID",
  "v1_DanhMuc_ChucVu_GetAll": "select*from  DM_ChucVu",
  "v1_DanhMuc_ChucVu_GetByID": "SET NOCOUNT ON; SELECT*FROM  DM_ChucVu a WHERE a.ChucVuID = @ChucVuID ;",
  "v1_DanhMuc_ChucVu_GetByName": "SELECT*FROM  DM_ChucVu a WHERE a.TenChucVu = @TenChucVu ;",
  "v1_DanhMuc_ChucVu_GetPagingBySearch": "SELECT * INTO #tmpTable FROM  DM_ChucVu WHERE TenChucVu LIKE CONCAT('%',@Keyword,'%') IF(@OrderByName = 'TenChucVu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TenChucVu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenChucVu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenChucVu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY GhiChu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY GhiChu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY else SELECT*FROM #tmpTable ORDER BY ChucVuID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; ;",
  "v1_DanhMuc_ChucVu_Insert": "insert into  DM_ChucVu ([TenChucVu] ,[GhiChu] ,[KeKhaiHangNam] ) VALUES (@TenChucVu ,@GhiChu ,@KeKhaiHangNam )",
  "v1_DanhMuc_ChucVu_Update": "Update  DM_ChucVu SET GhiChu = @GhiChu , TenChucVu= @TenChucVu, KeKhaiHangNam=@KeKhaiHangNam WHERE @ChucVuID = ChucVuID",
  "v1_DanhMuc_CoQuan_TrangThai_Update": "--- Xóa role cũ delete from DM_TrangThaiCongViec_CoQuan where CoQuanID = @CoQuanID and TrangThaiCongViecID = @TrangThaiID -- SET NOCOUNT ON insert into  DM_TrangThaiCongViec_CoQuan ([CoQuanID], [TrangThaiCongViecID] , [VaiTro] ) select @CoQuanID, @TrangThaiID, ID from @ListRoleID ---Thêm role mới select * from DM_TrangThaiCongViec_CoQuan",
  "v1_DanhMuc_CoQuanDonVi_DanhSachCoQuan_TrongCoQuanSuDungPhanMem_ByCoQuanDangNhap": "WITH RECURSIVE UpTree(CoQuanID, CoQuanChaID, SuDungPM) AS (
    SELECT CoQuanID, CoQuanChaID, SuDungPM
    FROM DM_CoQuan
    WHERE CoQuanID = @CoQuanID
    UNION ALL
    SELECT c.CoQuanID, c.CoQuanChaID, c.SuDungPM
    FROM DM_CoQuan c
    JOIN UpTree u ON u.CoQuanChaID = c.CoQuanID
),
-- lấy 1 cơ quan sử dụng phần mềm (gần nhất phía trên)
CoQuanSuDung AS (
    SELECT CoQuanID
    FROM UpTree
    WHERE SuDungPM = 1
    LIMIT 1
),
-- lấy toàn bộ cơ quan con (bao gồm chính nó)
DownTree(CoQuanID, CoQuanChaID) AS (
    SELECT CoQuanID, CoQuanChaID
    FROM DM_CoQuan
    WHERE CoQuanID = (SELECT CoQuanID FROM CoQuanSuDung)
    UNION ALL
    SELECT c.CoQuanID, c.CoQuanChaID
    FROM DM_CoQuan c
    JOIN DownTree d ON c.CoQuanChaID = d.CoQuanID
)
SELECT *
FROM DM_CoQuan
WHERE CoQuanID IN (SELECT CoQuanID FROM DownTree);
",
  "v1_DanhMuc_CoQuanDonVi_Delete": "DELETE FROM  DM_CoQuan WHERE CoQuanID = @CoQuanID",
  "v1_DanhMuc_CoQuanDonVi_GetAll": "select*from  DM_CoQuan",
  "v1_DanhMuc_CoQuanDonVi_GetAllByCap": "if(@Keyword is null) SELECT a.CoQuanID ,a.TenCoQuan,a.CoQuanChaID, a.MaCQ , a.CoQuanChaID AS ParentID, 0 AS Highlight FROM  DM_CoQuan a order by a.CapID asc else SELECT b.CoQuanID ,b.TenCoQuan,b.CoQuanChaID, b.MaCQ , b.CoQuanChaID AS ParentID, IIF(b.CoQuanID > 0 ,1,0) AS Highlight FROM  DM_CoQuan a LEFT JOIN ( SELECT*FROM  DM_CoQuan WHERE TenCoQuan LIKE CONCAT('%',@Keyword,'%') ) b ON b.CoQuanID = a.CoQuanID order by a.CapID asc",
  "v1_DanhMuc_CoQuanDonVi_GetAllCapCon": "if(@CoQuanID =0) SELECT CoQuanID, TenCoQuan, CoQuanChaID ,CapID, CQCoHieuLuc, SuDungPM FROM  DM_CoQuan; else -- with tmp as( SELECT CoQuanID, TenCoQuan, CoQuanChaID ,CapID, CQCoHieuLuc, SuDungPM INTO #CapTinh FROM  DM_CoQuan a WHERE --a.CoQuanChaID = @CoQuanID --or a.CoQuanID=@CoQuanID; Select tbHuyen.CoQuanID, tbHuyen.TenCoQuan, tbHuyen.CoQuanChaID ,tbHuyen.CapID, tbHuyen.CQCoHieuLuc, tbHuyen.SuDungPM INTO #CapHuyen from  DM_CoQuan as tbHuyen join #CapTinh on #CapTinh.CoQuanID = tbHuyen.CoQuanChaID; select * from #CapTinh union all select * from #CapHuyen union all select tbXa.CoQuanID, tbXa.TenCoQuan, tbXa.CoQuanChaID ,tbXa.CapID, tbXa.CQCoHieuLuc, tbxa.SuDungPM from  DM_CoQuan as tbXa join #CapHuyen on #CapHuyen.CoQuanID=tbXa.CoQuanChaID; drop TABLE #CapHuyen; drop TABLE #CapTinh; -- ) -- select * from tmp;",
  "v1_DanhMuc_CoQuanDonVi_GetAllCoQuanCon_DaCap": "declare @TrangThai bit; set @TrangThai=1; declare @ListCoQuanID  id_list declare @ListCoQuanChaID  id_list insert into @ListCoQuanChaID (CoQuanID) values (@CoQuanID); insert into @ListCoQuanID (CoQuanID) values (@CoQuanID); while @TrangThai=1 declare @listTemp  id_list; insert into @listTemp (CoQuanID) ((select CoQuanID from  DM_CoQuan where CoQuanChaID in (select * from @ListCoQuanChaID))); insert into @ListCoQuanID (CoQuanID) ((select CoQuanID from  DM_CoQuan where CoQuanChaID in (select * from @ListCoQuanChaID))); declare @SoCoQuanCon int; set @SoCoQuanCon=0; set @SoCoQuanCon =(select COUNT(*) from @listTemp) if @SoCoQuanCon>0 delete from @ListCoQuanChaID; insert into @ListCoQuanChaID (CoQuanID) (select * from @listTemp); else set @TrangThai=0; delete from @listTemp; select * from  DM_CoQuan where CoQuanID in (select * from @ListCoQuanID)",
  "v1_DanhMuc_CoQuanDonVi_GetAllIDByCoQuanChaID": "if(@CoQuanChaID =0) SELECT CoQuanID, TenCoQuan, CoQuanChaID FROM  DM_CoQuan; else SELECT CoQuanID, TenCoQuan, CoQuanChaID FROM  DM_CoQuan a WHERE a.CoQuanChaID = @CoQuanChaID;",
  "v1_DanhMuc_CoQuanDonVi_GetByID": "SELECT*,b.TenCoQuan as TenCoQuanCha FROM DM_CoQuan a LEFT JOIN DM_CoQuan b on b.CoQuanID = a.CoQuanChaID WHERE a.CoQuanID = @CoQuanID;",
  "v1_DanhMuc_CoQuanDonVi_GetByMaCQ": "select*from  DM_CoQuan where MaCQ =@MaCQ",
  "v1_DanhMuc_CoQuanDonVi_GetByName": "SELECT*FROM  DM_CoQuan a WHERE a.TenCoQuan = @TenCoQuan ;",
  "v1_DanhMuc_CoQuanDonVi_GetCoQuanSuDungPhanMem_By_CoQuanDangNhap": "WITH RECURSIVE CoQuanHierarchy AS (SELECT CapID, CQCoHieuLuc, SuDungPM, MaCQ, TenCoQuan, CoQuanID, CoQuanChaID, 1 AS Level FROM DM_CoQuan WHERE CoQuanID=@CoQuanID UNION ALL SELECT c.CapID, c.CQCoHieuLuc, c.SuDungPM, c.MaCQ, c.TenCoQuan, c.CoQuanID, c.CoQuanChaID, h.Level+1 FROM DM_CoQuan c INNER JOIN CoQuanHierarchy h ON c.CoQuanID=h.CoQuanChaID WHERE h.SuDungPM=0 AND h.Level<20) SELECT * FROM CoQuanHierarchy WHERE SuDungPM=1 LIMIT 1;",
  "v1_DanhMuc_CoQuanDonVi_Insert": "INSERT INTO  DM_CoQuan ( TenCoQuan, CoQuanChaID, CapID, ThamQuyenID, TinhID, HuyenID, XaID, CapUBND, CapThanhTra, CQCoHieuLuc, SuDungPM, MaCQ, SuDungQuyTrinh, MappingCode, IsDisable, TTChiaTachSapNhap, ChiaTachSapNhapDenCQID, IsStatus, CoQuanSuDungPhanMemID ) VALUES( @TenCoQuan, @CoQuanChaID, @CapID, @ThamQuyenID, @TinhID, @HuyenID, @XaID, @CapUBND, @CapThanhTra, @CQCoHieuLuc, @SuDungPM, @MaCQ, @SuDungQuyTrinh, @MappingCode, @IsDisable, @TTChiaTachSapNhap, @ChiaTachSapNhapDenCQID, @IsStatus, @CoQuanSuDungPhanMenID ); SELECT @CoQuanID = SCOPE_IDENTITY(); update  DM_CoQuan set CoQuanSuDungPhanMemID =IIF(@CoQuanSuDungPhanMenID =0 or @CoQuanSuDungPhanMenID is null,SCOPE_IDENTITY(),@CoQuanSuDungPhanMenID) where CoQuanID= SCOPE_IDENTITY()",
  "v1_DanhMuc_CoQuanDonVi_Update": "UPDATE  DM_CoQuan SET TenCoQuan = @TenCoQuan, CoQuanChaID = @CoQuanChaID, CapID =@CapID, ThamQuyenID = @ThamQuyenID, TinhID = @TinhID, HuyenID = @HuyenID, XaID = @XaID, CapUBND = @CapUBND, CapThanhTra = @CapThanhTra, CQCoHieuLuc = @CQCoHieuLuc, SuDungPM = @SuDungPM, MaCQ = @MaCQ, SuDungQuyTrinh = @SuDungQuyTrinh, MappingCode = @MappingCode, IsDisable = @IsDisable, TTChiaTachSapNhap = @TTChiaTachSapNhap, ChiaTachSapNhapDenCQID = @ChiaTachSapNhapDenCQID, IsStatus = @IsStatus WHERE CoQuanID = @CoQuanID;",
  "v1_DanhMuc_DiaGioiHanhChinh_GetAllByCap": "SELECT a.TinhID AS ID,
       a.TenTinh AS Ten,
       a.TenDayDu AS TenDayDu,
       (SELECT COUNT(*) FROM DM_Huyen aa WHERE aa.TinhID = a.TinhID) AS TotalChildren,
       0 AS Highlight,
       0 AS IDCha
FROM DM_Tinh a
WHERE @Cap = 1
  AND (@Keyword = '' OR a.TenDayDu LIKE '%' || @Keyword || '%' OR a.TenTinh LIKE '%' || @Keyword || '%')
UNION ALL
SELECT b.HuyenID AS ID,
       b.TenHuyen AS Ten,
       b.TenDayDu AS TenDayDu,
       (SELECT COUNT(*) FROM DM_Xa aa WHERE aa.HuyenID = b.HuyenID) AS TotalChildren,
       CASE WHEN c.HuyenID IS NOT NULL OR d.XaID IS NOT NULL THEN 1 ELSE 0 END AS Highlight,
       b.TinhID AS IDCha
FROM DM_Huyen b
LEFT JOIN (SELECT HuyenID FROM DM_Huyen WHERE TenHuyen LIKE '%' || @Keyword || '%' OR TenDayDu LIKE '%' || @Keyword || '%') c
       ON b.HuyenID = c.HuyenID
LEFT JOIN (SELECT XaID, HuyenID FROM DM_Xa WHERE TenXa LIKE '%' || @Keyword || '%' OR TenDayDu LIKE '%' || @Keyword || '%') d
       ON b.HuyenID = d.HuyenID
WHERE @Cap = 2
  AND (@ID = 0 OR b.TinhID = @ID)
UNION ALL
SELECT c.XaID AS ID,
       c.TenXa AS Ten,
       c.TenDayDu AS TenDayDu,
       0 AS TotalChildren,
       CASE WHEN b.XaID IS NOT NULL THEN 1 ELSE 0 END AS Highlight,
       c.HuyenID AS IDCha
FROM DM_Xa c
LEFT JOIN (SELECT XaID FROM DM_Xa WHERE TenXa LIKE '%' || @Keyword || '%' OR TenDayDu LIKE '%' || @Keyword || '%') b
       ON c.XaID = b.XaID
WHERE @Cap = 3
  AND (@ID = 0 OR c.HuyenID = @ID);",
  "v1_DanhMuc_TrangThai_ByRole": "select tt.TrangThaiCongViecID, tt.TenTrangThaiCongViec from DM_TrangThaiCongViec_CoQuan ttcq join DM_TrangThaiCongViec tt on ttcq.TrangThaiCongViecID = tt.TrangThaiCongViecID where ttcq.CoQuanID = @CoQuanID and ttcq.VaiTro = @VaiTro",
  "v1_DanhMuc_TrangThai_Delete": "-- SET NOCOUNT ON DELETE FROM  DM_TrangThaiCongViec WHERE TrangThaiCongViecID = @TrangThaiID; SET NOCOUNT OFF",
  "v1_DanhMuc_TrangThai_GetAll": "select*from  DM_TrangThaiCongViec",
  "v1_DanhMuc_TrangThai_GetByID": "SET NOCOUNT ON SELECT * FROM  DM_TrangThaiCongViec WHERE TrangThaiCongViecID=@TrangThaiID; SET NOCOUNT OFF",
  "v1_DanhMuc_TrangThai_GetByID_AndCoQuanID": "SET NOCOUNT ON SELECT * FROM  DM_TrangThaiCongViec tt left join  DM_TrangThaiCongViec_CoQuan ttcq on ttcq.CoQuanID= @CoQuanID and ttcq.TrangThaiCongViecID= tt.TrangThaiCongViecID WHERE tt.TrangThaiCongViecID=@TrangThaiID; SET NOCOUNT OFF",
  "v1_DanhMuc_TrangThai_GetByName": "select * from  DM_TrangThaiCongViec WHERE TenTrangThaiCongViec =@TenTrangThai;",
  "v1_DanhMuc_TrangThai_GetByTrangThaiCoQuan": "select*from  DM_TrangThaiCongViec_CoQuan where CoquanID = @CoquanID and TrangThaiCongViecID= @TrangThaiID",
  "v1_DanhMuc_TrangThai_GetPagingBySearch": "SET NOCOUNT ON; SELECT TrangThaiCongViecID, TenTrangThaiCongViec, TrangThaiSuDung INTO #tmpTable FROM  DM_TrangThaiCongViec WHERE TenTrangThaiCongViec LIKE CONCAT('%',@Keyword,'%'); IF(@OrderByName = 'TenTrangThai' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TenTrangThaiCongViec ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenTrangThai' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenTrangThaiCongViec DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TrangThaiSuDung' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TrangThaiSuDung ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TrangThaiSuDung' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TrangThaiSuDung DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TrangThaiID' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TrangThaiCongViecID ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable ORDER BY TrangThaiCongViecID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; SET NOCOUNT OFF ;",
  "v1_DanhMuc_TrangThai_Insert": "INSERT INTO  DM_TrangThaiCongViec( TenTrangThaiCongViec, TrangThaiSuDung ) VALUES ( @TenTrangThai, @TrangThaiSuDung ) select SCOPE_IDENTITY();",
  "v1_DanhMuc_TrangThai_Update": "-- SET NOCOUNT ON UPDATE  DM_TrangThaiCongViec SET --TenTrangThai = @TenTrangThai, TrangThaiSuDung = @TrangThaiSuDung WHERE TrangThaiCongViecID = @TrangThaiID",
  "v1_Dashboard_DSNhiemVu": "declare @tb_chung table( NhiemVuID int, TenNhiemVu nvarchar(250), NgayTao datetime2, NgayHetHan datetime2, NguoiTaoID int, MoTa nvarchar(MAX), CoQuanXuLyID int ); if(@VaiTro=2) -- lãnh đạo insert into @tb_chung select nv.NhiemVuID, nv.TenNhiemVu, nv.NgayTao, nv.NgayHetHan, nv.NguoiTaoID, nv.MoTa , IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID from NV_NhiemVu nv join NV_NhiemVu_LanhDaoTheoDoi ldtd on nv.NhiemVuID = ldtd.NhiemVuID left join NV_NhiemVu_CoQuan_CanBo nvcq on nv.NhiemVuID = nvcq.NhiemVuID and nvcq.LoaiPhanCong = 2 where ldtd.LanhDaoTheoDoiID = @CanBoID and nv.NhiemVuChaID is null else if (@VaiTro = 3) -- trưởng phòng insert into @tb_chung select nv.NhiemVuID, nv.TenNhiemVu, nv.NgayTao, nv.NgayHetHan, nv.NguoiTaoID, nv.MoTa , IIF(nv.LoaiNhiemVu = 2,nvcq.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID from NV_NhiemVu nv left join NV_NhiemVu_CoQuan_CanBo nvcq on nv.NhiemVuID = nvcq.NhiemVuID and nvcq.LoaiPhanCong = 2 where nv.CoQuanTaoID = @CoQuanID or (nvcq.CoQuanCanBoID = @CoQuanID and nv.LoaiNhiemVu = 2) and nv.NhiemVuChaID is null else if(@VaiTro = 4) -- Chuyên Viên insert into @tb_chung select nv.NhiemVuID, nv.TenNhiemVu, nv.NgayTao, nv.NgayHetHan, nv.NguoiTaoID, nv.MoTa , IIF(nv.LoaiNhiemVu = 2,nvcb.CoQuanCanBoID,nv.CoQuanTaoID) as CoQuanXuLyID from NV_NhiemVu nv left join NV_NhiemVu_CoQuan_CanBo nvcb on nv.NhiemVuID = nvcb.NhiemVuID and nvcb.LoaiPhanCong = 1 where nvcb.CoQuanCanBoID = @CanBoID and nv.NhiemVuChaID is null ---- select m.*, TenCoQuan as TenCoQuanXuLy, nvcb.CoQuanCanBoID as CanBoXuLyID, cb.TenCanBo as TenCanBoXuLy , IIF(m.SoCongViecChuaPhanCong > 0 or SoCongViec = 0, 1, iif(m.SoCongViecDangXuLy >0, 2, 3)) as TrangThai , IIF(m.SoCongViecQuaHan > 0 , 1, 0) as QuaHan , (select COUNT(*) from NV_NhiemVu where NhiemVuChaID = m.NhiemVuID and TrangThaiCongViecID !=6) SoCongViecDangXuLy1 , (select COUNT(*) from NV_NhiemVu where NhiemVuChaID = m.NhiemVuID and TrangThaiCongViecID =6) SoCongViecDaXuLy1 from (select tb.* , SUM(IIF(cv.NhiemVuID is not null,1,0)) as SoCongViec , sum(IIF(cv.TrangThaiCongViecID = 1,1,0)) as SoCongViecChuaPhanCong , sum(IIF(TrangThaiCongViecID !=6 and TrangThaiCongViecID != 1,1,0)) as SoCongViecDangXuLy, sum(IIF(TrangThaiCongViecID !=6 and cv.NgayHetHan < GETDATE(),1,0)) as SoCongViecQuaHan from @tb_chung tb left join NV_NhiemVu cv on cv.NhiemVuChaID = tb.NhiemVuID and cv.CoQuanTaoID in (select * from @ListCoQuanID) where IIF(@DateFilterType =1, tb.NgayTao, tb.NgayHetHan) >= @StartDate and IIF(@DateFilterType =1, tb.NgayTao, tb.NgayHetHan) <= @Date and (@CoQuanIDFilter = 0 or CoQuanXuLyID = @CoQuanIDFilter) group by tb.NhiemVuID, tb.CoQuanXuLyID, tb.MoTa, tb.NgayHetHan, tb.NgayTao, tb.NguoiTaoID, tb.TenNhiemVu )m left join DM_CoQuan cq on cq.CoQuanID = m.CoQuanXuLyID left join NV_NhiemVu_CoQuan_CanBo nvcb on nvcb.NhiemVuID = m.NhiemVuID and nvcb.LoaiPhanCong = 1 left join HT_CanBo cb on nvcb.CoQuanCanBoID = cb.CanBoID where (@TrangThai is null or @TrangThai = 0 or IIF(@TrangThai = 4, IIF(m.SoCongViecQuaHan > 0 , 1, 0), IIF(m.SoCongViecChuaPhanCong > 0 or SoCongViec = 0, 1, iif(m.SoCongViecDangXuLy >0, 2, 3))) = IIF(@TrangThai = 4, 1, @TrangThai)) and (@CanBoIDFilter is null or @CanBoIDFilter = 0 or (select COUNT(*) from NV_NhiemVu_CoQuan_CanBo nvcb where m.NhiemVuID = nvcb.NhiemVuID and LoaiPhanCong = 1 and nvcb.CoQuanCanBoID = @CanBoIDFilter)>0) SET NOCOUNT OFF",
  "v1_GetLastBackUpDB": "select top 1 *from  HT_SystemLog where CanBoID = @CanBoID and LogType = 901 order by SystemLogID desc",
  "v1_GetListSystemLogByCanBoIDAndLogInfo": "select*from  HT_SystemLog where CanBoID= @CanBoID and LogInfo = @LogInfo",
  "v1_GetListSystemLogFromTo": "select*from  HT_SystemLog where LogTime >= @TuNgay and LogTime <= @DenNgay",
  "v1_HeThong_CanBo_ChucVu_Delete_ByCanBoID": "DElete from  HT_CanBo_ChucVu WHERE CanBoID = @CanBoID;",
  "v1_HeThong_CanBo_ChucVu_GetBy_CanBoID": "SET NOCOUNT ON SELECT * FROM  HT_CanBo_ChucVu cbcv join  DM_ChucVu cv on cv.ChucVuID= cbcv.ChucVuID WHERE CanBoID=@CanBoID; SET NOCOUNT OFF",
  "v1_HeThong_CanBo_ChucVu_Insert": "--delete from  HT_CanBo_ChucVu where CanBoID = (select ID1 from @list_idCanBo_idChucVu) INSERT INTO HT_CanBo_ChucVu(CanBoID, ChucVuID) --VALUES ( select ID1, ID2 from @list_idCanBo_idChucVu; --) select SCOPE_IDENTITY();",
  "v1_HeThong_CanBo_DanhSachCanBo_TrongCoQuanSuDungPhanMem": "WITH RECURSIVE UpTree(CoQuanID, CoQuanChaID, SuDungPM) AS (
    SELECT CoQuanID, CoQuanChaID, SuDungPM
    FROM DM_CoQuan
    WHERE CoQuanID = @CoQuanID
    UNION ALL
    SELECT c.CoQuanID, c.CoQuanChaID, c.SuDungPM
    FROM DM_CoQuan c
    JOIN UpTree u ON u.CoQuanChaID = c.CoQuanID
),
CoQuanSuDung AS (
    SELECT CoQuanID
    FROM UpTree
    WHERE SuDungPM = 1
    LIMIT 1
),
DownTree(CoQuanID, CoQuanChaID) AS (
    SELECT CoQuanID, CoQuanChaID
    FROM DM_CoQuan
    WHERE CoQuanID = (SELECT CoQuanID FROM CoQuanSuDung)
    UNION ALL
    SELECT c.CoQuanID, c.CoQuanChaID
    FROM DM_CoQuan c
    JOIN DownTree d ON c.CoQuanChaID = d.CoQuanID
)
SELECT cb.*,cq.TenCoQuan
FROM HT_CanBo cb
JOIN DM_CoQuan cq ON cq.CoQuanID = cb.CoQuanID
WHERE cb.CoQuanID IN (SELECT CoQuanID FROM DownTree)
  AND cq.CQCoHieuLuc = 1;",
  "v1_HeThong_CanBo_DanhSachLeTan_TrongCoQuanSuDungPhanMem": "SELECT cb.CanBoID, nd.NguoiDungID, cb.TenCanBo, cq.CoQuanID, cq.TenCoQuan, cq.CQCoHieuLuc, max(pq.Quyen) FROM HT_NguoiDung nd JOIN HT_NguoiDung_NhomNguoiDung ndnnd ON ndnnd.NguoiDungID = nd.NguoiDungID JOIN HT_PhanQuyen pq ON pq.NhomNguoiDungID = ndnnd.NhomNguoiDungID JOIN HT_ChucNang cn ON cn.ChucNangID = pq.ChucNangID JOIN HT_CanBo cb ON cb.CanBoID = nd.CanBoID JOIN DM_CoQuan cq ON cq.CoQuanID = cb.CoQuanID WHERE cn.MaChucNang = 'checkin-out' AND cq.CQCoHieuLuc = 1 AND cq.CoQuanSuDungPhanMemID = @CoQuanID GROUP BY cb.CanBoID, nd.NguoiDungID, cb.TenCanBo, cq.CoQuanID, cq.TenCoQuan, cn.ChucNangID, cq.CQCoHieuLuc HAVING max(pq.Quyen) > 1",
  "v1_HeThong_CanBo_Delete": "SET NOCOUNT ON; delete  HT_NguoiDung_NhomNguoiDung where NguoiDungID =(select NguoiDungID from  HT_NguoiDung where CanBoID=@CanBoID) DElete from  HT_NguoiDung WHERE CanBoID = @CanBoID; delete  HT_CanBo_ChucVu where CanBoID=@CanBoID DElete from  HT_CanBo WHERE CanBoID = @CanBoID;",
  "v1_HeThong_CanBo_GetAll": "select * from  HT_CanBo cb join  HT_NguoiDung nd on nd.CanBoID=cb.CanBoID LEFT JOIN  DM_CoQuan cq on cb.CoQuanID = cq.CoQuanID WHERE cb.CanBoID <> 1",
  "v1_HeThong_CanBo_GetAllByNhiemVuChaID": "select *from  NV_NhiemVu_CoQuan_CanBo kn join  NV_NhiemVu nv on kn.NhiemVuID = nv.NhiemVuID left join  HT_CanBo cb on cb.CanBoID = kn.CoQuanCanBoID where kn.NhiemVuID = @NhiemVuChaID and kn.LoaiPhanCong = 1",
  "v1_HeThong_CanBo_GetAllByNhiemVuID": "select distinct cb.CanBoID,cb.TenCanBo,cb.MaCB from  NV_NhiemVu_CoQuan_CanBo nvcq join  NV_NhiemVu nv on nv.NhiemVuID = nvcq.NhiemVuID left join  HT_CanBo cb on cb.CanBoID = nvcq.CoQuanCanBoID where nvcq.LoaiPhanCong =1",
  "v1_HeThong_CanBo_GetAllCanBoByChucVuAndCoQuan": "select cb.CanBoID,cb.TenCanBo,cb.NgaySinh,cb.GioiTinh,cb.DiaChi,cb.QuyenKy,cb.Email,cb.DienThoai,cb.PhongBanID,cb.CoQuanID,cb.XemTaiLieuMat, nd.NguoiDungID,cb.AnhHoSo,cb.MaCB,cb.CapQuanLy,cb.TrangThaiID,cb.VaiTro,cb.ChucVuID from  HT_CanBo cb join  HT_NguoiDung nd on cb.CanBoID = nd.NguoiDungID where CoQuanID = @CoQuanID and ChucVuID = @ChucVuID",
  "v1_HeThong_CanBo_GetAllInCoQuan": "select*from  HT_CanBo cb join  DM_CoQuan cq on cq.CoQuanID= cb.CoQuanID where cb.CoQuanID = @CoQuanID",
  "v1_HeThong_CanBo_GetAllInListCoQuan": "select*from  HT_CanBo cb join  DM_CoQuan cq on cq.CoQuanID = cb.CoQuanID where cb.CoQuanID in (select CoQuanID from @ListCoQuanID) order by cb.CoQuanID",
  "v1_HeThong_CanBo_GetByID": "select cb.*,nd.*, (select top 1 FileUrl from NV_FileDinhKem where ThongTinVaoRaID = cb.CanBoID and LoaiFile = 3 and LaCanBo = 1 order by FileDinhKemID desc) as FileUrl from  HT_CanBo cb left join  HT_NguoiDung nd on cb.CanBoID = nd.CanBoID where cb.CanBoID = @CanBoID",
  "v1_HeThong_CanBo_GetByMaCB": "select* from  HT_CanBo -- join  HT_NguoiDung nd on nd.CanBoID=cb.CanBoID WHERE MaCB = @MaCB;",
  "v1_HeThong_CanBo_GetByName": "select* from  HT_CanBo cb -- join  HT_NguoiDung nd on nd.CanBoID=cb.CanBoID WHERE TenCanBo = @TenCanBo;",
  "v1_HeThong_CanBo_GetCanBoByChucVuID": "select *from  HT_CanBo_ChucVu where ChucVuID = @ChucVuID",
  "v1_HeThong_CanBo_GetDanhSachLeTan": "SELECT cb.CanBoID, nd.NguoiDungID, cb.TenCanBo, cq.CoQuanID, cq.TenCoQuan FROM HT_NguoiDung nd JOIN HT_NguoiDung_NhomNguoiDung ndnnd ON ndnnd.NguoiDungID = nd.NguoiDungID JOIN HT_PhanQuyen pq ON pq.NhomNguoiDungID = ndnnd.NhomNguoiDungID JOIN HT_ChucNang cn ON cn.ChucNangID = pq.ChucNangID JOIN HT_CanBo cb ON cb.CanBoID = nd.CanBoID JOIN DM_CoQuan cq ON cq.CoQuanID = cb.CoQuanID WHERE cn.MaChucNang = 'checkin-out' AND cq.CQCoHieuLuc = 1 GROUP BY cb.CanBoID, nd.NguoiDungID, cb.TenCanBo, cq.CoQuanID, cq.TenCoQuan, cn.ChucNangID HAVING max(pq.Quyen) > 1",
  "v1_HeThong_CanBo_GetPagingBySearch": "SELECT a.CanBoID , a.MaCB, a.TenCanBo , a.NgaySinh, a.GioiTinh , a.DiaChi , a.ChucVuID , a.QuyenKy , a.Email , a.DienThoai , a.PhongBanID , a.CoQuanID , a.RoleID , a.QuanTriDonVi , a.CoQuanCuID , a.CanBoCuID , a.XemTaiLieuMat , a.TrangThaiID, a.AnhHoSo , a.HoKhau , a.CapQuanLy, a.VaiTro, b.NguoiDungID INTO #tmpTable FROM HT_CanBo a LEFT JOIN HT_NguoiDung b ON a.CanBoID = b.CanBoID WHERE (a.TenCanBo like CONCAT('%',@Keyword,'%') or a.MaCB like CONCAT('%',@Keyword,'%') or b.TenNguoiDung like concat('%',@Keyword,'%')) AND (@CoQuanID is null OR @CoQuanID = a.CoQuanID) AND (@TrangThaiID is null OR @TrangThaiID = a.TrangThaiID) IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenCanBo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT * FROM #tmpTable ORDER BY CanBoID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; ;",
  "v1_HeThong_CanBo_GetPagingBySearch_New": "SELECT a.CanBoID , a.MaCB, a.TenCanBo , a.NgaySinh, a.GioiTinh , a.DiaChi , a.ChucVuID , a.QuyenKy , a.Email , a.DienThoai , a.PhongBanID , a.CoQuanID , a.RoleID , a.QuanTriDonVi , a.CoQuanCuID , a.CanBoCuID , a.XemTaiLieuMat , a.TrangThaiID, a.AnhHoSo , a.HoKhau , a.CapQuanLy, a.VaiTro, b.NguoiDungID, c.CapID,b.TenNguoiDung, c.TenCoQuan, a.LaLeTan INTO #tmpTable FROM HT_CanBo a LEFT JOIN HT_NguoiDung b ON a.CanBoID = b.CanBoID LEFT JOIN  DM_CoQuan c ON c.CoQuanID = a.CoQuanID WHERE (a.TenCanBo like CONCAT('%',@Keyword,'%') or a.MaCB like CONCAT('%',@Keyword,'%') or b.TenNguoiDung like CONCAT('%',@Keyword,'%')) AND (@CoQuanID is null OR @CoQuanID = a.CoQuanID) AND (@TrangThaiID is null OR @TrangThaiID = a.TrangThaiID) and a.CoQuanID in (select ID from @DanhSachCoQuan) IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenCanBo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT * FROM #tmpTable ORDER BY CanBoID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; ;",
  "v1_HeThong_CanBo_Insert": "INSERT INTO  HT_CanBo ( MaCB, TenCanBo , NgaySinh , GioiTinh, DiaChi, ChucVuID, QuyenKy, Email, DienThoai, PhongBanID, CoQuanID, RoleID, QuanTriDonVi, CoQuanCuID, CanBoCuID, XemTaiLieuMat, TrangThaiID, AnhHoSo, HoKhau, CapQuanLy, VaiTro, CMND, NgayCap, NoiCap, LaLeTan ) VALUES ( @MaCB, @TenCanBo, @NgaySinh, @GioiTinh, @DiaChi, @ChucVuID, @QuyenKy, @Email, @DienThoai, @PhongBanID, @CoQuanID, @RoleID, @QuanTriDonVi , @CoQuanCuID , @CanBoCuID , @XemTaiLieuMat , @TrangThaiID , @AnhHoSo , @HoKhau , @CapQuanLy, @VaiTro, @CMND, @NgayCap , @NoiCap, @LaLeTan ); set @CanBoID = Scope_identity(); select Scope_identity();",
  "v1_HeThong_CanBo_Update": "UPDATE  HT_CanBo SET MaCB = @MaCB, TenCanBo = @TenCanBo, NgaySinh = @NgaySinh, GioiTinh = @GioiTinh, DiaChi = @DiaChi, ChucVuID = @ChucVuID, QuyenKy = @QuyenKy, Email= @Email, DienThoai = @DienThoai, PhongBanID = @PhongBanID, CoQuanID = @CoQuanID, RoleID = @RoleID, QuanTriDonVi = @QuanTriDonVi, CoQuanCuID = @CoQuanCuID, CanBoCuID = @CanBoCuID, XemTaiLieuMat = @XemTaiLieuMat, TrangThaiID = @TrangThaiID, AnhHoSo = @AnhHoSo, HoKhau = @HoKhau, CapQuanLy=@CapQuanLy, VaiTro =@VaiTro , CMND = @CMND , NgayCap= @NgayCap ,NoiCap =@NoiCap , LaLeTan=@LaLeTan WHERE CanBoID = @CanBoID; UPDATE  HT_NguoiDung SET TenNguoiDung = @TenNguoiDung , MatKhau = @MatKhau where CanBoID = @CanBoID",
  "v1_HeThong_ChucNang_GetPagingBySearch": "WITH tmpTable AS (
    SELECT 
        cn.ChucNangID, 
        cn.TenChucNang, 
        cn.ChucNangChaID, 
        cn.MaChucNang, 
        cncha.TenChucNang as TenChucNangCha, 
        cn.ThuTuSapXep
    FROM  HT_ChucNang cn
    LEFT JOIN  HT_ChucNang cncha ON cncha.ChucNangID = cn.ChucNangChaID
    WHERE cn.TenChucNang LIKE '%' || @Keyword || '%'
)
SELECT 
    t.*, 
    COUNT(*) OVER() AS TotalRow
FROM tmpTable t
ORDER BY
    CASE WHEN @OrderByName = 'TenChucNang' AND @OrderByOption = 'ASC' THEN t.TenChucNang END ASC,
    CASE WHEN @OrderByName = 'TenChucNang' AND @OrderByOption = 'DESC' THEN t.TenChucNang END DESC,
    CASE WHEN @OrderByName = 'TenChucNangCha' AND @OrderByOption = 'ASC' THEN t.TenChucNangCha END ASC,
    CASE WHEN @OrderByName = 'TenChucNangCha' AND @OrderByOption = 'DESC' THEN t.TenChucNangCha END DESC,
    CASE WHEN @OrderByName NOT IN ('TenChucNang','TenChucNangCha') THEN t.ThuTuSapXep END ASC
OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY;",
  "v1_HeThong_HuongDanSuDung_Delete": "delete from  HT_HuongDanSuDung where HuongDanSuDungID in (select ID from @DanhSachHuongDanSuDungID)",
  "v1_HeThong_HuongDanSuDung_GetByChucNangID": "select * from  HT_HuongDanSuDung hd join  HT_ChucNang cn on cn.ChucNangID=hd.ChucNangID where hd.ChucNangID=@ChucNangID",
  "v1_HeThong_HuongDanSuDung_GetByID": "select * from  HT_HuongDanSuDung hd join  HT_ChucNang cn on cn.MaChucNang=hd.MaChucNang where HuongDanSuDungID=@HuongDanSuDungID",
  "v1_HeThong_HuongDanSuDung_GetByMaChucNang": "select top 1 * from  HT_HuongDanSuDung --join  HT_ChucNang cn on cn.ChucNangID=hd.ChucNangID where MaChucNang=@MaChucNang",
  "v1_HeThong_HuongDanSuDung_GetPagingBySearch": "SELECT hd.ChucNangID, hd.HuongDanSuDungID, hd.NgayCapNhat, hd.NguoiCapNhat, hd.TenFie",
  "v1_HeThong_HuongDanSuDung_Insert": "insert into  HT_HuongDanSuDung (ChucNangID,TieuDe,TenFie",
  "v1_HeThong_HuongDanSuDung_Update": "update  HT_HuongDanSuDung set ChucNangID=@ChucNangID ,TieuDe=@TieuDe ,TenFie",
  "v1_HeThong_NguoiDung_GetAllInListCoQuan": "select*from  HT_NguoiDung nd join  HT_CanBo cb on cb.CanBoID = nd.CanBoID join  DM_CoQuan cq on cq.CoQuanID=cb.CoQuanID where cb.CoQuanID in (select CoQuanID from @ListCoQuanID);",
  "v1_HeThong_NguoiDung_GetBy_CanBoID": "Select* from  HT_NguoiDung nd join  HT_CanBo cb on cb.CanBoID=nd.CanBoID WHERE cb.CanBoID =@CanBoID;",
  "v1_HeThong_NguoiDung_GetByID": "Select* from  HT_NguoiDung a LEFT JOIN  HT_CanBo b on a.CanBoID=b.CanBoID WHERE NguoiDungID =@NguoiDungID;",
  "v1_HeThong_Nguoidung_GetByIDForPhanQuyen": "SET NOCOUNT ON SELECT * FROM HT_NguoiDung nd join HT_CanBo cb on nd.CanBoID = cb.CanBoID join DM_CoQuan cq on cq.CoQuanID= cb.CoQuanID WHERE nd.NguoiDungID =@NguoiDungID; SET NOCOUNT OFF",
  "v1_HeThong_NguoiDung_GetByName": "Select* from  HT_NguoiDung where TenNguoiDung = @TenNguoiDung",
  "v1_HeThong_NguoiDung_GetListBy_NhomNguoiDungID": "declare @CoQuanCapTinh int ; declare @NhomTong int; declare @NhomTongID int; set @CoQuanCapTinh=(select top 1 CoQuanID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID); set @NhomTong=(select NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID); set @NhomTongID=iif(@NhomTong=0,@NhomNguoiDungID,@NhomTong); --select * --into #tbCoQuanID --from (select top 1 CoQuanID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID -- union all -- select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh -- union all -- select CoQuanID from  DM_CoQuan where CoQuanChaID in (select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh)) SELECT nd.NguoiDungID, nd.TenNguoiDung , cb.CanBoID, cb.TenCanBo, cq.TenCoQuan FROM  HT_NguoiDung nd join  HT_CanBo cb on cb.CanBoID= nd.CanBoID join  DM_CoQuan cq on cq.CoQuanID= cb.CoQuanID where cb.CoQuanID in ( select top 1 CoQuanID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID union all select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh union all select CoQuanID from  DM_CoQuan where CoQuanChaID in (select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh) ) and nd.NguoiDungID not in ( Select ndnnd.NguoiDungID from  HT_NguoiDung_NhomNguoiDung ndnnd join  HT_NhomNguoiDung nnd on nnd.NhomNguoiDungID= ndnnd.NhomNguoiDungID join  HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID where ndnnd.NhomNguoiDungID= @NhomNguoiDungID or( nnd.NhomTongID=@NhomTongID and nnd.CoQuanID in ( select top 1 CoQuanID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID union all select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh union all select CoQuanID from  DM_CoQuan where CoQuanChaID in (select CoQuanID from  DM_CoQuan where CoQuanChaID=@CoQuanCapTinh) )) ) ;",
  "v1_HeThong_NguoiDung_GetPagingBySearch": "-- if(@CoQuanID is not NULL AND @TrangThai is null) -- SELECT a.NguoiDungID , a.TenNguoiDung , a.MatKhau , a.GhiChu , a.TrangThai, b.CanBoID, b.TenCanBo, a.PublicKeys , c.CoQuanID, c.TenCoQuan INTO #tmpTable1 FROM  HT_NguoiDung a INNER JOIN  HT_CanBo b on b.CanBoID = a.CanBoID inner join  DM_CoQuan c on b.CoQuanID = c.CoQuanID WHERE ( (a.TenNguoiDung LIKE CONCAT('%',@Keyword,'%') OR b.TenCanBo LIKE CONCAT('%',@Keyword,'%')) AND (@CoQuanID is null or @CoQuanID=0 or @CoQuanID = c.CoQuanID)) and (@TrangThai is null or @TrangThai = a.TrangThai) and NguoiDungID>1 and c.CoQuanID in (select ID from @DanhSachCoQuan) IF(@OrderByName = 'TenNguoiDung' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable1 ORDER BY TenNguoiDung ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenNguoiDung' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable1 ORDER BY TenNguoiDung DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY else SELECT*FROM #tmpTable1 ORDER BY NguoiDungID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable1); DROP TABLE #tmpTable1",
  "v1_HeThong_NguoiDung_Insert": "insert into  HT_NguoiDung ( TenNguoiDung, MatKhau, GhiChu, TrangThai, CanBoID, PublicKeys, MatKhauCu ) VALUES( @TenNguoiDung, @MatKhau, @GhiChu, @TrangThai, @CanBoID, @PublicKeys, @MatKhauCu ); set @NguoiDungID = SCOPE_IDENTITY();",
  "v1_HeThong_NguoiDung_NhomNguoiDung_Delete": "DElete from  HT_NguoiDung_NhomNguoiDung WHERE NguoiDungID = @NguoiDungID and NhomNguoiDungID=@NhomNguoiDungID;",
  "v1_HeThong_NguoiDung_NhomNguoiDung_Delete_ByCanBoID": "DElete from  HT_NguoiDung_NhomNguoiDung WHERE NguoiDungID = @NguoiDungID;",
  "v1_HeThong_NguoiDung_NhomNguoiDung_GetBy_NguoiDungID": "SET NOCOUNT ON SELECT * FROM  HT_NguoiDung_NhomNguoiDung cbcv join  HT_NhomNguoiDung cv on cv.NhomNguoiDungID= cbcv.NhomNguoiDungID WHERE NguoiDungID=@NguoiDungID; SET NOCOUNT OFF",
  "v1_HeThong_NguoiDung_ResetPassword": "update  HT_NguoiDung set MatKhau = @MatKhau , MatKhauCu = @MatKhauCu where @NguoiDungID = NguoiDungID",
  "v1_HeThong_NhomNguoiDung_GetListNhomApDungChoTatCa": "Select* from  HT_NhomNguoiDung where ApDungCho =1",
  "v1_HeThong_PhanQuyen_ChucNang_GetQuyenByNhomNguoiDungID": "SELECT pq.NhomNguoiDungID , cn.ChucNangID , cn.TenChucNang , cn.MaChucNang , pq.Quyen , pq.PhanQuyenID FROM  HT_PhanQuyen pq join  HT_ChucNang cn on cn.ChucNangID=pq.ChucNangID WHERE pq.NhomNguoiDungID = @NhomNguoidungID;",
  "v1_HeThong_PhanQuyen_ChucNang_GetQuyenDuocThaoTac": "declare @NhomTongID int set @NhomTongID= (select NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoidungID) set @NhomTongID = iif(@NhomTongID=0,@NhomNguoiDungID,@NhomTongID) SELECT pq.NhomNguoiDungID , cn.ChucNangID , cn.TenChucNang , cn.MaChucNang , pq.Quyen , pq.PhanQuyenID FROM  HT_PhanQuyen pq join  HT_ChucNang cn on cn.ChucNangID=pq.ChucNangID WHERE pq.NhomNguoiDungID = @NhomTongID;",
  "v1_HeThong_PhanQuyen_Delete": "delete from  HT_PhanQuyen WHERE PhanQuyenID =@PhanQuyenID;",
  "v1_HeThong_PhanQuyen_DeleteByNhomNguoiDungID": "delete from  HT_PhanQuyen WHERE NhomNguoiDungID =@NhomNguoiDungID;",
  "v1_HeThong_PhanQuyen_DeleteByNhomTongID": "delete from  HT_PhanQuyen WHERE NhomNguoiDungID in (select nnd.NhomNguoiDungID from  HT_NhomNguoiDung nnd where nnd.NhomNguoiDungID= @NhomNguoiDungID or nnd.NhomTongID=@NhomNguoiDungID);",
  "v1_HeThong_PhanQuyen_GetByID": "SELECT * FROM  HT_PhanQuyen WHERE PhanQuyenID = @PhanQuyenID;",
  "v1_HeThong_PhanQuyen_GetByNhomNguoiDungID_And_ChucNangID": "SELECT pq.NhomNguoiDungID , cn.ChucNangID , cn.TenChucNang , cn.MaChucNang , pq.Quyen , pq.PhanQuyenID FROM  HT_PhanQuyen pq join  HT_ChucNang cn on cn.ChucNangID=pq.ChucNangID WHERE pq.NhomNguoiDungID = @NhomNguoidungID and pq.ChucNangID=@ChucNangID;",
  "v1_HeThong_PhanQuyen_Insert": "-- SET NOCOUNT ON INSERT INTO  HT_PhanQuyen( ChucNangID, NhomNguoiDungID, Quyen ) VALUES ( @ChucNangID, @NhomNguoiDungID, @Quyen )",
  "v1_HeThong_PhanQuyen_NguoiDung_NhomNguoiDung_GetBy_ListNhomNguoiDungID": "select * from  HT_NguoiDung_NhomNguoiDung ndnnd join  HT_NguoiDung nd on nd.NguoiDungID= ndnnd.NguoiDungID where NhomNguoiDungID in (select ID from @DanhSachNhomNguoiDungID)",
  "v1_HeThong_PhanQuyen_NguoiDung_NhomNguoiDung_GetByNguoiDungID": "SELECT top (1) * FROM HT_NguoiDung_NhomNguoiDung WHERE NguoiDungID = @NguoiDungID",
  "v1_HeThong_PhanQuyen_NguoiDung_NhomNguoiDung_GetByNguoiDungID_And_NhomNguoiDungID": "declare @NhomTong int; declare @NhomTongID int; declare @NhomNguoiDungCuaDonVi int; declare @CoQuanID int; set @NhomTong=(select NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID); set @NhomTongID=iif(@NhomTong=0,@NhomNguoiDungID,@NhomTong); set @CoQuanID=( select top 1 cb.CoQuanID from  HT_NguoiDung nd join  HT_CanBo cb on cb.CanBoID = nd.CanBoID where nd.NguoiDungID=@NguoiDungID); set @NhomNguoiDungCuaDonVi= (select nnd.NhomNguoiDungID from  HT_NhomNguoiDung nnd where ( nnd.NhomNguoiDungID=@NhomNguoiDungID or nnd.NhomTongID=@NhomTongID) and nnd.CoQuanID=@CoQuanID ); Select * from  HT_NguoiDung_NhomNguoiDung where NhomNguoiDungID= @NhomNguoiDungCuaDonVi and NguoiDungID=@NguoiDungID",
  "v1_HeThong_PhanQuyen_NguoiDung_NhomNguoiDung_Insert": "INSERT INTO  HT_NguoiDung_NhomNguoiDung( NguoiDungID ,NhomNguoiDungID ) VALUES ( @NguoiDungID, @NhomNguoiDungID )",
  "v1_HeThong_PhanQuyen_NguoiDung_NhomNguoiDung_Insert_One": "INSERT INTO  HT_NguoiDung_NhomNguoiDung( NguoiDungID ,NhomNguoiDungID ) VALUES ( (select ID1 from @ListNguoiDungNhomNguoiDung), (select ID2 from @ListNguoiDungNhomNguoiDung) )",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_DanhSachNhomTrongNhomTong": "declare @crNhomTong int set @crNhomTong=0; set @crNhomTong = (select NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID) if @crNhomTong=0 or @crNhomTong is null SELECT nnd.NhomNguoiDungID, nnd.TenNhom, nnd.GhiChu, nnd.ApDungCho, nnd.CoQuanID, cq.TenCoQuan FROM  HT_NhomNguoiDung nnd join  DM_CoQuan cq on nnd.CoQuanID=cq.CoQuanID WHERE nnd.NhomNguoiDungID=@NhomNguoiDungID or nnd.NhomTongID = @NhomNguoiDungID; else SELECT nnd.NhomNguoiDungID, nnd.TenNhom, nnd.GhiChu, nnd.ApDungCho, nnd.CoQuanID, cq.TenCoQuan FROM  HT_NhomNguoiDung nnd join  DM_CoQuan cq on nnd.CoQuanID=cq.CoQuanID WHERE nnd.NhomNguoiDungID=@crNhomTong or nnd.NhomTongID = @crNhomTong;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_Delete": "delete from  HT_NhomNguoiDung WHERE NhomNguoiDungID =@NhomNguoiDungID;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_DeleteByID": "declare @NhomTongID int; declare @SoLuongNhomConConLai int; set @NhomTongID= (Select top 1 NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID) set @NhomTongID=iif(@NhomTongID=0,@NhomNguoiDungID,@NhomTongID) delete from  HT_PhanQuyen where NhomNguoiDungID in (select NhomNguoiDungID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID or NhomTongID=@NhomNguoiDungID) delete from  HT_NhomNguoiDung WHERE NhomNguoiDungID =@NhomNguoiDungID or NhomTongID=@NhomNguoiDungID; set @SoLuongNhomConConLai= (select COUNT(*) from  HT_NhomNguoiDung where NhomTongID=@NhomTongID group by NhomTongID) if(@SoLuongNhomConConLai is null or @SoLuongNhomConConLai<1) delete from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomTongID",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_DeleteByNhomTongID": "delete from  HT_NhomNguoiDung WHERE NhomTongID=@NhomNguoiDungID;",
  "v1_HeThong_PhanQuyen_NhomNguoidung_GetAll": "SET NOCOUNT ON; SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho , nnd.CoQuanID , nnd.NhomTongID , nnd.CoQuanTao FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) and nnd.NhomNguoiDungID>1 and (@CoQuanFilter is null or @CoQuanFilter=0 or nnd.CoQuanID=@CoQuanFilter) and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) SET NOCOUNT OFF ;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_GetByID": "SELECT*FROM  HT_NhomNguoiDung WHERE NhomNguoiDungID = @NhomNguoiDungID;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_GetByName": "Select* from  HT_NhomNguoiDung where TenNhom = @TenNhom",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_GetByNhomTongID": "SELECT nnd.NhomNguoiDungID, nnd.TenNhom, nnd.GhiChu, nnd.ApDungCho, nnd.CoQuanID, cq.TenCoQuan FROM  HT_NhomNguoiDung nnd join  DM_CoQuan cq on nnd.CoQuanID=cq.CoQuanID WHERE nnd.NhomTongID = @NhomTongID or nnd.NhomNguoiDungID=@NhomTongID;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_GetListNhomCuaDonViCon": "declare @NhomTongID int set @NhomTongID =( select NhomTongID from  HT_NhomNguoiDung where NhomNguoiDungID=@NhomNguoiDungID) set @NhomTongID=iif(@NhomTongID=0,@NhomNguoiDungID,@NhomTongID) SELECT nnd.NhomNguoiDungID, nnd.TenNhom, nnd.GhiChu, nnd.ApDungCho, nnd.CoQuanID, cq.TenCoQuan FROM  HT_NhomNguoiDung nnd join  DM_CoQuan cq on nnd.CoQuanID=cq.CoQuanID WHERE nnd.NhomTongID = @NhomTongID and nnd.CoQuanID in (select ID from @DanhSachCoQuan) ;",
  "v1_HeThong_PhanQuyen_NhomNguoidung_GetPagingBySearch_New": "SET NOCOUNT ON; -- nhóm của các cơ quan con if(@CoQuanFilter is null or @CoQuanFilter=0) select * INTO #tmpTable from ( SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) --and NhomTongID=0 and nnd.NhomNguoiDungID>1 and nnd.NhomNguoiDungID in ( select nnd.NhomTongID from  HT_NhomNguoiDung nnd where (nnd.CoQuanID in (select ID from @DanhSachCoQuan) ) and (nnd.NhomTongID not in ( SELECT nnd1.NhomNguoiDungID FROM  HT_NhomNguoiDung nnd1 WHERE nnd1.CoQuanID = @CoQuanID and nnd1.NhomNguoiDungID>1 union select nnd3.NhomTongID as NhomNguoiDungID from  HT_NhomNguoiDung nnd3 WHERE nnd3.CoQuanID = @CoQuanID and nnd3.NhomNguoiDungID>1 -- group by NhomTongID ) ) group by nnd.NhomTongID ) union all SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) and CoQuanID = @CoQuanID and nnd.NhomNguoiDungID>1 and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) ) as tmpTable group by tmpTable.ApDungCho, tmpTable.GhiChu, tmpTable.NhomNguoiDungID, tmpTable.TenNhom ; IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TenNhom ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenNhom DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY GhiChu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY GhiChu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable ORDER BY NhomNguoiDungID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; else SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho INTO #tmpTable1 FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) and CoQuanID = @CoQuanFilter and nnd.NhomNguoiDungID>1 and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) group by nnd.NhomNguoiDungID, nnd.TenNhom, nnd.GhiChu, nnd.ApDungCho IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable1 ORDER BY TenNhom ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable1 ORDER BY TenNhom DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable1 ORDER BY GhiChu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable1 ORDER BY GhiChu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable1 ORDER BY NhomNguoiDungID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable1); DROP TABLE #tmpTable; SET NOCOUNT OFF ;",
  "v1_HeThong_PhanQuyen_NhomNguoidung_GetPagingBySearch_New1": "SET NOCOUNT ON; -- nhóm của các cơ quan con if(@CoQuanFilter is null or @CoQuanFilter=0) select * INTO #tmpTable from (SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) --and NhomTongID=0 and nnd.NhomNguoiDungID>1 and nnd.NhomNguoiDungID in ( select nnd.NhomTongID from  HT_NhomNguoiDung nnd where (nnd.CoQuanID in (select ID from @DanhSachCoQuan) ) and (nnd.NhomTongID not in ( SELECT nnd1.NhomNguoiDungID FROM  HT_NhomNguoiDung nnd1 WHERE nnd1.CoQuanID = @CoQuanID and nnd1.NhomNguoiDungID>1 union select nnd3.NhomTongID as NhomNguoiDungID from  HT_NhomNguoiDung nnd3 WHERE nnd3.CoQuanID = @CoQuanID and nnd3.NhomNguoiDungID>1 -- group by NhomTongID ) ) group by nnd.NhomTongID ) and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) union all SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) and CoQuanID = @CoQuanID and nnd.NhomNguoiDungID>1 and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) ) as tmpTable; IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TenNhom ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenNhom DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY GhiChu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY GhiChu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable ORDER BY NhomNguoiDungID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable; else SELECT nnd.NhomNguoiDungID ,nnd.TenNhom ,nnd.GhiChu ,nnd.ApDungCho INTO #tmpTable1 FROM  HT_NhomNguoiDung nnd left join HT_NguoiDung_NhomNguoiDung ndnnd on ndnnd.NhomNguoiDungID= nnd.NhomNguoiDungID left join HT_NguoiDung nd on nd.NguoiDungID=ndnnd.NguoiDungID WHERE (TenNhom LIKE CONCAT('%',@Keyword,'%') OR nnd.GhiChu LIKE CONCAT('%',@Keyword,'%')) and CoQuanID = @CoQuanFilter and nnd.NhomNguoiDungID>1 and (@CanBoID is null or @CanBoID=0 or nd.CanBoID=@CanBoID) IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable1 ORDER BY TenNhom ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenNhom' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable1 ORDER BY TenNhom DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable1 ORDER BY GhiChu ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'GhiChu' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable1 ORDER BY GhiChu DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable1 ORDER BY NhomNguoiDungID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable1); DROP TABLE #tmpTable; SET NOCOUNT OFF ;",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_Insert": "--declare @NhomTong",
  "v1_HeThong_PhanQuyen_NhomNguoiDung_UpdateNhomTong": "-- SET NOCOUNT ON UPDATE  HT_NhomNguoiDung SET [TenNhom] = @TenNhom, [GhiChu] = @GhiChu, ApDungCho=@ApDungCho WHERE [NhomNguoiDungID] = @NhomNguoiDungID UPDATE  HT_NhomNguoiDung SET [TenNhom] = @TenNhom, [GhiChu] = @GhiChu WHERE NhomTongID= @NhomNguoiDungID",
  "v1_HeThong_PhanQuyen_Update": "-- SET NOCOUNT ON UPDATE  HT_PhanQuyen SET -- ChucNangID=@ChucNangID, -- NhomNguoiDungID=@NhomNguoiDungID, Quyen=@Quyen WHERE PhanQuyenID=@PhanQuyenID",
  "v1_HT_ChucNang_GetByCoQuanID": "-- lấy cơ quan sử dụng phần mềm: có thể là cơ quan hiện tại đang đăng nhập. có thể là cơ quan cấp trên của cơ quan đang đăng nhập --declare @CoQuanSuDungPhanMemID int; --set @CoQuanSuDungPhanMemID=0; --declare @stt int; --set @stt=0; --while @CoQuanSuDungPhanMemID =0 -- -- if @stt=20 -- -- set @CoQuanSuDungPhanMemID=0; -- break; -- -- else -- -- set @stt=@stt+1; -- declare @TrangThai bit; -- set @TrangThai=0; -- set @TrangThai=(select SuDungPM from  DM_CoQuan where CoQuanID=@CoQuanID); -- if @TrangThai=1 -- -- set @CoQuanSuDungPhanMemID= @CoQuanID -- -- else -- -- set @CoQuanID = (select CoQuanChaID from  DM_CoQuan where CoQuanID=@CoQuanID); -- -- --; ---------------------- ---- lấy danh sách cơ quan con trong hệ thống của cơ quan sử dụng phần mềm --declare @TrangThai1 bit; --set @TrangThai1=1; --declare @ListCoQuanID  id_list --declare @ListCoQuanChaID  id_list --insert into @ListCoQuanChaID (CoQuanID) values (@CoQuanSuDungPhanMemID); --insert into @ListCoQuanID (CoQuanID) values (@CoQuanSuDungPhanMemID); --while @TrangThai1=1 -- -- declare @listTemp  id_list; -- insert into @listTemp (CoQuanID) ((select CoQuanID from  DM_CoQuan where CoQuanChaID in (select * from @ListCoQuanChaID))); -- insert into @ListCoQuanID (CoQuanID) ((select CoQuanID from  DM_CoQuan where CoQuanChaID in (select * from @ListCoQuanChaID))); -- declare @SoCoQuanCon int; -- set @SoCoQuanCon=0; -- set @SoCoQuanCon =(select COUNT(*) from @listTemp) -- if @SoCoQuanCon>0 -- -- delete from @ListCoQuanChaID; -- insert into @ListCoQuanChaID (CoQuanID) (select * from @listTemp); -- -- else -- -- set @TrangThai1=0; -- -- delete from @listTemp; -- --select * from @ListCoQuanID ------------------- Lấy danh sách chức năng trong list cơ quan SELECT cn.ChucNangID, cn.TenChucNang, cn.MaChucNang, pq.Quyen FROM HT_ChucNang cn LEFT JOIN HT_PhanQuyen pq on pq.ChucNangID = cn.ChucNangID LEFT JOIN HT_NhomNguoiDung nnd on nnd.NhomNguoiDungID = pq.NhomNguoiDungID WHERE nnd.CoQuanID =@CoQuanID",
  "v1_HT_ChucNang_GetByNguoidungID": "SELECT cn.ChucNangID, cn.TenChucNang,pk.Quyen, cn.MaChucNang FROM HT_NguoiDung as nd JOIN HT_CanBo as cb ON nd.CanBoID = cb.CanBoID JOIN HT_NguoiDung_NhomNguoiDung as ndnnd ON ndnnd.NguoiDungID = nd.NguoiDungID JOIN HT_NhomNguoiDung nnd ON nnd.NhomNguoiDungID = ndnnd.NhomNguoiDungID JOIN HT_PhanQuyen pk ON pk.NhomNguoiDungID = nnd.NhomNguoiDungID JOIN HT_ChucNang cn ON cn.ChucNangID = pk.ChucNangID WHERE nd.NguoiDungID = @NguoiDungID order by cn.ThuTuSapXep",
  "v1_HT_GetNhomNguoiDungByCoQuanID": "select *from  HT_NhomNguoiDung where CoQuanID = @CoQuanID and CoQuanID is not null",
  "v1_HT_NguoiDung_GetByLogin": "SELECT * FROM HT_NguoiDung nd JOIN HT_CanBo cb ON nd.CanBoID = cb.CanBoID LEFT JOIN DM_CoQuan cq ON cq.CoQuanID = cb.CoQuanID WHERE nd.TenNguoiDung = @TenNguoiDung AND nd.MatKhau = @MatKhau AND (IFNULL(cq.CQCoHieuLuc,0) = 1 OR cb.CanBoID = 1);",
  "v1_HT_SystemConfig_Delete": "--SET NOCOUNT ON DELETE FROM  HT_SystemConfig WHERE [SystemConfigID] = @SystemConfigID SET NOCOUNT OFF",
  "v1_HT_SystemConfig_GetByID": "SET NOCOUNT ON SELECT [SystemConfigID], [ConfigKey], [ConfigValue], [Description] FROM  HT_SystemConfig WHERE [SystemConfigID] = @SystemConfigID SET NOCOUNT OFF",
  "v1_HT_SystemConfig_GetByKey": "select * from HT_SystemConfig where ConfigKey = @ConfigKey",
  "v1_HT_SystemConfig_GetPagingBySearch": "WITH Filtered AS (
    SELECT 
        SystemConfigID,
        ConfigKey,
        ConfigValue,
        Description
    FROM HT_SystemConfig
    WHERE ConfigKey LIKE '%' || @Keyword || '%'
       OR Description LIKE '%' || @Keyword || '%'
       OR ConfigValue LIKE '%' || @Keyword || '%'
)
SELECT 
    f.SystemConfigID,
    f.ConfigKey,
    f.ConfigValue,
    f.Description,
    (SELECT COUNT(1) FROM Filtered) AS TotalRow
FROM Filtered f
ORDER BY 
    CASE WHEN @OrderByName = 'ConfigKey' AND @OrderByOption = 'ASC'  THEN f.ConfigKey END ASC,
    CASE WHEN @OrderByName = 'ConfigKey' AND @OrderByOption = 'DESC' THEN f.ConfigKey END DESC,
    CASE WHEN @OrderByName = 'ConfigValue' AND @OrderByOption = 'ASC'  THEN f.ConfigValue END ASC,
    CASE WHEN @OrderByName = 'ConfigValue' AND @OrderByOption = 'DESC' THEN f.ConfigValue END DESC,
    CASE WHEN @OrderByName = 'Description' AND @OrderByOption = 'ASC'  THEN f.Description END ASC,
    CASE WHEN @OrderByName = 'Description' AND @OrderByOption = 'DESC' THEN f.Description END DESC,
    CASE WHEN @OrderByName NOT IN ('ConfigKey','ConfigValue','Description') THEN f.SystemConfigID END DESC
LIMIT @pLimit OFFSET @pOffset;
",
  "v1_HT_SystemConfig_Insert": "INSERT INTO HT_SystemConfig( ConfigKey, ConfigValue, Description ) VALUES ( @ConfigKey, @ConfigValue, @Description ) select SCOPE_IDENTITY();",
  "v1_HT_SystemConfig_Update": "-- SET NOCOUNT ON UPDATE  HT_SystemConfig SET ConfigKey = @ConfigKey, ConfigValue = @ConfigValue, Description= @Description WHERE SystemConfigID= @SystemConfigID",
  "v1_HT_UpdateLog": "update  HT_SystemLog set IsLogNotify = 1 where SystemLogID = @LogID",
  "v1_NV_FileDinhKem_Delete": "Delete from  NV_FileDinhKem where FileDinhKemID = @FileDinhKemID",
  "v1_NV_FileDinhKem_GetBy_ThongTinRaVaoID": "select * from  NV_FileDinhKem where ThongTinVaoRaID = @ThongTinRaVaoID",
  "v1_NV_FileDinhKem_Insert": "INSERT INTO  NV_FileDinhKem ( FileUrl, LoaiFile , NgayTao , NguoiTaoID, TenFile",
  "v1_NV_FileDinhKemAnh_Insert": "INSERT INTO NV_FileDinhKem
(
    FileUrl,
    LoaiFile,
    NgayTao,
    NguoiTaoID,
    TenFileGoc,
    TenFileHeThong,
    ThongTinVaoRaID,
    CoBaoMat
)
VALUES
(
    @FileUrl,
    @LoaiFile,
    @NgayTao,
    @NguoiTaoID,
    @TenFileGoc,
    @TenFileHeThong,
    @ThongTinVaoRaID,
    @CoBaoMat
);

SELECT last_insert_rowid();",
  "v1_NV_FileDinhKemAnh_Insert_New": "INSERT INTO NV_FileDinhKem
(
    FileUrl,
    LoaiFile,
    NgayTao,
    NguoiTaoID,
    TenFileGoc,
    TenFileHeThong,
    ThongTinVaoRaID,
    CoBaoMat,
    LaCanBo
)
VALUES
(
    @FileUrl,
    @LoaiFile,
    @NgayTao,
    @NguoiTaoID,
    @TenFileGoc,
    @TenFileHeThong,
    @ThongTinVaoRaID,
    @CoBaoMat,
    @LaCanBo
);

SELECT last_insert_rowid();",
  "v1_NV_ThongKe_KhachVaoRa": "WITH start_end AS (
    SELECT 
        CASE WHEN @TuNgay IS NULL THEN 0 ELSE @TuNgay END AS startDate,
        CASE WHEN @DenNgay IS NULL THEN 0 ELSE @DenNgay END AS endDate
),
tmp AS (
    SELECT vr.*,
           vr.TenCoQuan AS NoiCongTac,
           CASE 
               WHEN vr.DonViCaNhan = 2 THEN cbgap.TenCanBo
               ELSE ''
           END AS TenCanBoGap,
           CASE 
               WHEN vr.DonViCaNhan = 2 THEN cqGap2.CoQuanID
               ELSE cqGap1.CoQuanID
           END AS GapBoPhanID,
           CASE 
               WHEN vr.DonViCaNhan = 2 THEN cqGap2.TenCoQuan
               ELSE cqGap1.TenCoQuan
           END AS TenBoPhanGap
    FROM NV_ThongTinVaoRa vr
    JOIN HT_CanBo letan ON letan.CanBoID = vr.LeTan_Vao
    LEFT JOIN HT_CanBo cbgap ON cbgap.CanBoID = vr.GapCanBo AND vr.DonViCaNhan = 2
    LEFT JOIN DM_CoQuan cqGap2 ON cqGap2.CoQuanID = cbgap.CoQuanID AND vr.DonViCaNhan = 2
    LEFT JOIN DM_CoQuan cqGap1 ON cqGap1.CoQuanID = vr.GapCanBo AND vr.DonViCaNhan = 1
    CROSS JOIN start_end se
    WHERE (@TuNgay IS NULL OR vr.GioVao_Int >= se.startDate)
      AND (@DenNgay IS NULL OR vr.GioVao_Int <= se.endDate)
      AND (@CanBoGapID IS NULL OR vr.GapCanBo = @CanBoGapID)
      AND (@LeTanID IS NULL OR @LeTanID = 0 OR vr.LeTan_Vao = @LeTanID)
      AND (@CoQuanID IS NULL OR @CoQuanID = 0 OR vr.DonViSuDungID = @CoQuanID)
)
SELECT t.*,
       (SELECT COUNT(1) FROM tmp) AS TotalRow
FROM tmp t
ORDER BY GioVao DESC;",
  "v1_NV_ThongTinKhach_GetBy_SoCMND": "select * from  nv_thongtinkhach where socmnd = @SoCMND",
  "v1_NV_ThongTinKhach_Insert": "INSERT INTO  NV_ThongTinKhach ( HoVaTen, NgaySinh, HoKhau, DienThoai, SoCMND, NoiCapCMND, NgayCapCMND ) VALUES ( @HoVaTen, @NgaySinh, @HoKhau, @DienThoai, @SoCMND, @NoiCapCMND, @NgayCapCMND ) select SCOPE_IDENTITY();",
  "v1_NV_ThongTinVaoRa_Get_For_CheckOut_By_AnhChanDung": "select *, vr.TenCoQuan as NoiCongTac, iif(vr.DonViCaNhan=1,cq.TenCoQuan,cb.TenCanBo) as TonViCaNhan from  NV_ThongTinVaoRa vr join  NV_FileDinhKem f on f.ThongTinVaoRaID = vr.ThongTinVaoRaID and f.LoaiFile=3 left join  HT_CanBo cb on cb.CanBoID = vr.GapCanBo and vr.DonViCaNhan =2 left join  DM_CoQuan cq on cq.CoQuanID = vr.GapCanBo and vr.DonViCaNhan =1 where vr.GioRa is null and vr.DonViSuDungID = @DonViSuDungID --and LoaiFile=3 order by GioVao desc",
  "v1_NV_ThongTinVaoRa_GetBy_CMND": "SELECT vr.*,
       vr.TenCoQuan AS NoiCongTac,
       f.*
FROM NV_ThongTinVaoRa AS vr
LEFT JOIN NV_FileDinhKem AS f 
       ON f.ThongTinVaoRaID = vr.ThongTinVaoRaID
WHERE vr.SoCMND LIKE '%' || @MaThe || '%'
  AND (vr.GioRa_Int = 0 OR vr.GioRa_Int IS NULL)
  AND vr.DonViSuDungID = @DonViSuDungID
ORDER BY vr.GioVao DESC;",
  "v1_NV_ThongTinVaoRa_GetBy_HoTen": "select *, vr.TenCoQuan as NoiCongTac from NV_ThongTinVaoRa vr left join NV_FileDinhKem f on f.ThongTinVaoRaID= vr.ThongTinVaoRaID where HoVaTen LIKE '%' || @MaThe || '%' and (GioRa_Int=0 or GioRa_Int is null) and vr.DonViSuDungID = @DonViSuDungID --order by GioVao_Int desc order by GioVao desc",
  "v1_NV_ThongTinVaoRa_GetBy_ID": "SELECT 
    vr.*,
    cqsdpm.TenCoQuan AS TenDonViSuDung,
    vr.TenCoQuan AS NoiCongTac,
    CASE 
        WHEN vr.DonViCaNhan = 1 THEN cq.TenCoQuan
        ELSE cb.TenCanBo
    END AS TenDonViCaNhan,
    (SELECT TenFileHeThong 
     FROM NV_FileDinhKem 
     WHERE LoaiFile = 1 
       AND ThongTinVaoRaID = vr.ThongTinVaoRaID 
     LIMIT 1) AS AnhCMND_MT,
    (SELECT TenFileHeThong 
     FROM NV_FileDinhKem 
     WHERE LoaiFile = 2 
       AND ThongTinVaoRaID = vr.ThongTinVaoRaID 
     LIMIT 1) AS AnhCMND_MS,
    (SELECT TenFileHeThong 
     FROM NV_FileDinhKem 
     WHERE LoaiFile = 3 
       AND ThongTinVaoRaID = vr.ThongTinVaoRaID 
     LIMIT 1) AS AnhChanDung
FROM NV_ThongTinVaoRa vr
JOIN DM_CoQuan cqsdpm 
    ON cqsdpm.CoQuanID = vr.DonViSuDungID
LEFT JOIN DM_CoQuan cq 
    ON cq.CoQuanID = vr.GapCanBo 
   AND vr.DonViCaNhan = 1
LEFT JOIN HT_CanBo cb 
    ON cb.CanBoID = vr.GapCanBo 
   AND vr.DonViCaNhan = 2
WHERE vr.ThongTinVaoRaID = @ThongTinVaoRaID;",
  "v1_NV_ThongTinVaoRa_GetBy_MaThe": "SELECT *
FROM NV_ThongTinVaoRa AS vr
LEFT JOIN NV_FileDinhKem AS f 
    ON f.ThongTinVaoRaID = vr.ThongTinVaoRaID
WHERE vr.MaThe = @MaThe
  AND (vr.GioRa_Int = 0 OR vr.GioRa_Int IS NULL)
  AND vr.DonViSuDungID = @DonViSuDungID
ORDER BY vr.GioVao DESC;",
  "v1_NV_ThongTinVaoRa_GetBy_SoCMND": "SELECT *
FROM NV_ThongTinVaoRa vr
LEFT JOIN NV_FileDinhKem f ON f.ThongTinVaoRaID = vr.ThongTinVaoRaID
WHERE vr.SoCMND LIKE '%' || @SoCMND || '%'
  AND (vr.GioRa_Int = 0 OR vr.GioRa_Int IS NULL)
  AND vr.DonViSuDungID = @DonViSuDungID
ORDER BY vr.GioVao DESC
LIMIT 1;",
  "v1_NV_ThongTinVaoRa_GetListPageBySearch": "WITH Filtered AS (
    SELECT vr.*, 
           vr.TenCoQuan AS NoiCongTac,
           CASE 
               WHEN vr.DonViCaNhan = 2 THEN cb.TenCanBo
               WHEN vr.DonViCaNhan = 1 THEN cq.TenCoQuan
               ELSE NULL
           END AS TenDonViCaNhan
    FROM NV_ThongTinVaoRa vr
    LEFT JOIN HT_CanBo cb ON cb.CanBoID = vr.GapCanBo AND vr.DonViCaNhan = 2
    LEFT JOIN DM_CoQuan cq ON cq.CoQuanID = vr.GapCanBo AND vr.DonViCaNhan = 1
    WHERE (@Keyword IS NULL OR HoVaTen LIKE '%'||@Keyword||'%' OR SoCMND LIKE '%'||@Keyword||'%' OR MaThe = @Keyword)
      AND (@Type IS NULL OR @Type=1 OR (@Type=2 AND (GioRa_Int=0 OR GioRa_Int IS NULL)) OR (@Type=3 AND GioRa_Int>0))
      AND vr.DonViSuDungID = @DonViSuDungID
      AND (@NgayCheckIn IS NULL OR GioVao_Int = @NgayCheckIn)
),
Counted AS (
    SELECT COUNT(1) AS TotalRow FROM Filtered
)
SELECT f.*,
       (SELECT TenFileHeThong FROM NV_FileDinhKem f1 WHERE f1.LoaiFile = 1 AND f1.ThongTinVaoRaID = f.ThongTinVaoRaID LIMIT 1) AS AnhCMND_MT,
       (SELECT TenFileHeThong FROM NV_FileDinhKem f2 WHERE f2.LoaiFile = 2 AND f2.ThongTinVaoRaID = f.ThongTinVaoRaID LIMIT 1) AS AnhCMND_MS,
       (SELECT TenFileHeThong FROM NV_FileDinhKem f3 WHERE f3.LoaiFile = 3 AND f3.ThongTinVaoRaID = f.ThongTinVaoRaID LIMIT 1) AS AnhChanDung,
       (SELECT TotalRow FROM Counted) AS TotalRow
FROM Filtered f
ORDER BY GioVao DESC
LIMIT @pLimit OFFSET @pOffset;",
  "v1_NV_ThongTinVaoRa_Insert": "--declare @matheLonNhat varchar(20); --declare @mt int; --declare @maThePrefix varchar(20); --declare @MaTheHienTai varchar(20); --set @maThePrefix=CONCAT(CONVERT(varchar, ConvertDateToInt(@GioVao)),'.'); --set @matheLonNhat =right((select top 1 MaThe from  NV_ThongTinVaoRa -- where  ConvertDateToInt(GioVao) =  ConvertDateToInt(@GioVao) -- order by GioVao desc), 5); -- if(@matheLonNhat is null or LEN(@matheLonNhat) <1) -- -- set @mt = 1; -- -- else -- -- set @mt = CONVERT(int, @matheLonNhat) + 1; -- -- set @matheLonNhat =convert(varchar,@mt); -- if(LEN(@matheLonNhat)<5) -- -- set @MaTheHienTai= -- IIF(LEN(@matheLonNhat)=1, CONCAT(@maThePrefix,'0000',@matheLonNhat) -- , IIF(LEN(@matheLonNhat)=2, CONCAT(@maThePrefix,'000',@matheLonNhat) -- , IIF(LEN(@matheLonNhat)=3, CONCAT(@maThePrefix,'00',@matheLonNhat) -- , CONCAT(@maThePrefix,'0',@matheLonNhat) -- ))); -- -- else -- -- set @MaTheHienTai=CONCAT(@maThePrefix, @matheLonNhat); -- -- --set @matheLonNhat = @MaThe; INSERT INTO  NV_ThongTinVaoRa ( GioVao, GapCanBo, LeTan_Vao , MaThe, HoVaTen, NgaySinh , HoKhau , DienThoai , SoCMND , NoiCapCMND , NgayCapCMND ,TenCoQuan , DonViSuDungID , ThanNhiet , DonViCaNhan , GioiTinh , LoaiGiayTo , LyDoGap ) VALUEs ( @GioVao, @GapCanBo, @LeTan_Vao, @MaTheTuNhap, @HoVaTen , @NgaySinh , @HoKhau , @DienThoai , @SoCMND , @NoiCapCMND , @NgayCapCMND ,@TenCoQuan , @DonViSuDungID , @ThanNhiet , @DonViCaNhan , @GioiTinh , @LoaiGiayTo , @LyDoGap ) set @MaThe = @MaTheTuNhap; select SCOPE_IDENTITY();",
  "v1_NV_ThongTinVaoRa_TongHopTheoNgay": "SELECT 
    COUNT(*) AS Tong,
    SUM(CASE WHEN GioRa_Int = 0 THEN 1 ELSE 0 END) AS DangGap,
    SUM(CASE WHEN GioRa_Int = 0 THEN 0 ELSE 1 END) AS DaVe
FROM NV_ThongTinVaoRa vr
WHERE vr.GioVao_Int = CAST(strftime('%Y%m%d', 'now') AS INTEGER)
  AND vr.DonViSuDungID = @DonViSuDungID;",
  "v1_NV_ThongTinVaoRa_Update_GioRa": "update  NV_ThongTinVaoRa set LeTan_Ra= @LeTan_Ra, GioRa= @GioRa where ThongTinVaoRaID=@ThongTinVaoRaID",
  "v1_SystemLog_GetPagingByQuanTriDuLieu": "SET NOCOUNT ON; SELECT sl.SystemLogID, cq.TenCoQuan, cb.TenCanBo, sl.LogInfo, sl.LogTime INTO #tmpTable FROM  HT_SystemLog sl LEFT JOIN  HT_CanBo cb ON sl.CanBoID=cb.CanBoID LEFT JOIN  DM_CoQuan cq ON cb.CoQuanID=cq.CoQuanID WHERE (sl.LogType=901 or sl.LogType=902) AND ( LogInfo LIKE concat('%', @Keyword,'%') or TenCanBo LIKE concat('%', @Keyword,'%')) IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY TenCanBo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogInfo' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY LogInfo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogInfo' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY LogInfo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogTime' AND @OrderByOption = 'ASC') SELECT*FROM #tmpTable ORDER BY LogTime ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogTime' AND @OrderByOption = 'DESC') SELECT*FROM #tmpTable ORDER BY LogTime DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT*FROM #tmpTable ORDER BY SystemLogID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY SET @TotalRow = (SELECT COUNT(*) FROM #tmpTable); DROP TABLE #tmpTable; SET NOCOUNT OFF ;",
  "v1_SystemLog_GetPagingBySearch": "SELECT sl.SystemLogID, cq.TenCoQuan, cb.TenCanBo, sl.LogInfo, sl.LogTime INTO #tmpTable FROM  HT_SystemLog sl LEFT JOIN  HT_CanBo cb ON sl.CanBoID=cb.CanBoID LEFT JOIN  DM_CoQuan cq ON cb.CoQuanID=cq.CoQuanID WHERE sl.LogType>0 AND (LogInfo LIKE CONCAT('%', @Keyword, '%') OR cb.TenCanBo LIKE CONCAT('%', @Keyword, '%') OR cq.TenCoQuan LIKE CONCAT('%', @Keyword, '%')) IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCoQuan ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY TenCoQuan DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY TenCanBo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogInfo' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY LogInfo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogInfo' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY LogInfo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogTime' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY LogTime ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'LogTime' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY LogTime DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT * FROM #tmpTable ORDER BY SystemLogID DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY; SET @TotalRow = (SELECT COUNT(*) FROM #tmpTable); DROP TABLE #tmpTable;",
  "v1_SystemLog_Insert": "INSERT INTO HT_SystemLog(CanBoID,LogInfo,LogTime,LogType,SystemLogType,NhiemVuID) VALUES(@CanBoID,@LogInfo,@LogTime,@LogType,@SystemLogType,@NhiemVuID); SELECT last_insert_rowid();",
  "v2_CapNhatThongTinCanBo": "UPDATE  HT_CanBo SET TenCanBo = @TenCanBo, Email= @Email, CoQuanID = @CoQuanID WHERE CanBoID = @CanBoID; delete from  HT_NguoiDung_NhomNguoiDung where NguoiDungID=@NguoiDungID",
  "V2_CapNhatThongTinDonViSuDungPhanMem": "UPDATE  DM_CoQuan SET TenCoQuan=@TenCanBo, TinhID=@TinhID, HuyenID=@HuyenID, XaID=@XaID, DiaChi = @DiaChi, CQCoHieuLuc=@TrangThai WHERE CoQuanID = @CoQuanID; update  HT_CanBo set TenCanBo=@TenCanBo, Email = @Email, DienThoai=@DienThoai where CanBoID=@CanBoID update  HT_NguoiDung set TenNguoiDung= @TenNguoiDung, MatKhau=@MatKhau where NguoiDungID=@NguoiDungID",
  "V2_CapNhatTrangThaiSuDungPhanMem": "UPDATE  DM_CoQuan SET CQCoHieuLuc=@TrangThai WHERE CoQuanID = @CoQuanID;",
  "v2_ChiTietDonViSuDungPhanMem": "SELECT cq.CoQuanID, cq.TenCoQuan, cq.TinhID, cq.HuyenID, cq.XaID, cq.DiaChi, cq.SuDungPM, cq.CQCoHieuLuc as TrangThai , cb.TenCanBo, cb.CanBoID, cb.DienThoai, cb.Email , nd.NguoiDungID, nd.TenNguoiDung , t.TenTinh, h.TenHuyen, x.TenXa from  DM_CoQuan cq join HT_CanBo cb on cb.CoQuanID= cq.CoQuanID and cb.RoleID=1 join HT_NguoiDung nd on nd.CanBoID = cb.CanBoID left join  DM_Tinh t on t.TinhID=cq.TinhID left join  DM_Huyen h on h.HuyenID = cq.HuyenID left join  DM_Xa x on x.XaID = cq.XaID WHERE cq.CoQuanID = @CoQuanID;",
  "v2_DanhSachCanBoThuocDonViSuDungPhanMen": "SELECT cb.CanBoID, cb.TenCanBo, nd.NguoiDungID, nd.TenNguoiDung, nd.TrangThai, cq.CoQuanID, cq.TenCoQuan INTO #tmpTable FROM  HT_CanBo cb JOIN  DM_CoQuan cq ON cq.CoQuanID = cb.CoQuanID JOIN  HT_NguoiDung nd ON nd.CanBoID = cb.CanBoID WHERE (cq.CoQuanChaID = @CoQuanChaID OR cq.CoQuanID = @CoQuanChaID) AND (@CoQuanID IS NULL OR @CoQuanID = 0 OR cb.CoQuanID = @CoQuanID) AND (@Keyword IS NULL OR cq.TenCoQuan LIKE CONCAT('%', @Keyword, '%') OR cb.TenCanBo LIKE CONCAT('%', @Keyword, '%')) AND (cb.RoleID = 0 OR cb.RoleID IS NULL); IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCoQuan ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY TenCoQuan DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCanBo' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY TenCanBo DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT * FROM #tmpTable ORDER BY TenCoQuan, TenCanBo ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY; SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable;",
  "v2_DanhSachDonViSuDungPhanMem": "SELECT cq.CoQuanID, cq.TenCoQuan, cq.TinhID, cq.HuyenID, cq.XaID, cq.DiaChi, cq.SuDungPM, cq.CQCoHieuLuc AS TrangThai, cb.TenCanBo, cb.CanBoID, cb.DienThoai, cb.Email, nd.NguoiDungID, nd.TenNguoiDung, t.TenTinh, h.TenHuyen, x.TenXa INTO #tmpTable FROM  DM_CoQuan cq JOIN HT_CanBo cb ON cb.CoQuanID = cq.CoQuanID AND cb.RoleID = 1 JOIN HT_NguoiDung nd ON nd.CanBoID = cb.CanBoID LEFT JOIN  DM_Tinh t ON t.TinhID = cq.TinhID LEFT JOIN  DM_Huyen h ON h.HuyenID = cq.HuyenID LEFT JOIN  DM_Xa x ON x.XaID = cq.XaID WHERE cq.SuDungPM = 1 AND cq.TenCoQuan LIKE CONCAT('%', @Keyword, '%'); IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'ASC') SELECT * FROM #tmpTable ORDER BY TenCoQuan ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE IF(@OrderByName = 'TenCoQuan' AND @OrderByOption = 'DESC') SELECT * FROM #tmpTable ORDER BY TenCoQuan DESC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY ELSE SELECT * FROM #tmpTable ORDER BY TenCoQuan ASC OFFSET @pOffset ROWS FETCH NEXT @pLimit ROWS ONLY; SET @TotalRow = (SELECT COUNT(1) FROM #tmpTable); DROP TABLE #tmpTable;",
  "v2_DanhSachNhomNguoiDungCuaNguoiDung": "SELECT nd.NguoiDungID, nd.NhomNguoiDungID , nnd.TenNhom FROM HT_NguoiDung_NhomNguoiDung nd join  HT_NhomNguoiDung nnd on nnd.nhomnguoidungid = nd.nhomnguoidungid WHERE NguoiDungID = @NguoiDungID",
  "v2_HeThong_CanBo_InsertAdminDonVi": "INSERT INTO  HT_CanBo ( TenCanBo, CoQuanID, DienThoai, Email, RoleID ) VALUES ( @TenCanBo, @CoQuanID, @DienThoai, @Email, 1 ) select Scope_identity();",
  "v2_HeThong_CanBo_ThemMoiCanBoVaoPhongBan": "INSERT INTO  HT_CanBo ( TenCanBo, CoQuanID, Email, RoleID, TrangThaiID ) VALUES ( @TenCanBo, @CoQuanID, @Email, 0, 1 ) select Scope_identity();",
  "v2_HeThong_NguoiDung_KiemTraTonTaiTaiKhoan": "Select* from  HT_NguoiDung where TenNguoiDung = @TenNguoiDung",
  "v2_HeThong_PhanQuyen_ThemNguoiDungVaoNhom": "INSERT INTO  HT_NguoiDung_NhomNguoiDung( NguoiDungID ,NhomNguoiDungID ) VALUES ( @NguoiDungID, @NhomNguoiDungID ) select Scope_identity();",
  "v2_KhoiTaoDonViSuDungPhanMem": "Declare @CoQuanID int INSERT INTO  DM_CoQuan ( TenCoQuan, TinhID, HuyenID, XaID, CQCoHieuLuc, SuDungPM, DiaChi ) VALUES( @TenCoQuan, @TinhID, @HuyenID, @XaID, 1, 1, @DiaChi ); set @CoQuanID = SCOPE_IDENTITY(); update  DM_CoQuan set CoQuanSuDungPhanMemID = @CoQuanID select @CoQuanID",
  "v2_NhomNguoiDungCuaCoQuan": "SELECT * from  HT_NhomNguoiDung where NhomTongID= @NhomTongID and CoQuanID= @CoQuanID",
  "v2_NV_ThongTinVaoRa_Update_GioRa": "update  NV_ThongTinVaoRa set LeTan_Ra= @LeTan_Ra, GioRa= @GioRa , GioRa_Int = @GioRa_Int where ThongTinVaoRaID=@ThongTinVaoRaID",
  "v2_NV_TruyVetYTe_ToanTinh": "declare @startDate int declare @Date int set @startDate=IIF(@TuNgay is null, 0,  ConvertDateToInt(@TuNgay)) set @Date=IIF(@DenNgay is null, 0,  ConvertDateToInt(@DenNgay)) -- lấy danh sách gặp cán bộ select vr.*, vr.TenCoQuan as NoiCongTac, cbgap.TenCanBo as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap into #tmp from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  HT_CanBo cbgap on cbgap.CanBoID = vr.GapCanBo and vr.DonViCaNhan=2 join  DM_CoQuan cqGap on cqGap.CoQuanID= cbgap.CoQuanID where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@TinhID is null or @TinhID =0 or cqGap.TinhID=@TinhID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) -- lấy danh sách gắp cơ quan insert into #tmp select vr.*, vr.TenCoQuan as NoiCongTac, '' as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  DM_CoQuan cqGap on cqGap.CoQuanID= vr.GapCanBo and DonViCaNhan =1 where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@TinhID is null or @TinhID =0 or cqGap.TinhID=@TinhID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) select * from #tmp order by GioVao desc set @TotalRow =(SELECT COUNT(1) FROM #tmp); select @TuNgay, @DenNgay, @startDate, @Date drop table #tmp;",
  "v2_NV_TruyVetYTe_TrongDonVi": "declare @startDate int declare @Date int set @startDate=IIF(@TuNgay is null, 0,  ConvertDateToInt(@TuNgay)) set @Date=IIF(@DenNgay is null, 0,  ConvertDateToInt(@DenNgay)) -- lấy danh sách gặp cán bộ select vr.*, vr.TenCoQuan as NoiCongTac, cbgap.TenCanBo as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap into #tmp from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  HT_CanBo cbgap on cbgap.CanBoID = vr.GapCanBo and vr.DonViCaNhan=2 join  DM_CoQuan cqGap on cqGap.CoQuanID= cbgap.CoQuanID where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@DonViSuDungID is null or @DonViSuDungID =0 or vr.DonViSuDungID=@DonViSuDungID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) -- lấy danh sách gắp cơ quan insert into #tmp select vr.*, vr.TenCoQuan as NoiCongTac, '' as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  DM_CoQuan cqGap on cqGap.CoQuanID= vr.GapCanBo and DonViCaNhan =1 where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@DonViSuDungID is null or @DonViSuDungID =0 or vr.DonViSuDungID=@DonViSuDungID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) select * from #tmp order by GioVao desc set @TotalRow =(SELECT COUNT(1) FROM #tmp); select @TuNgay, @DenNgay, @startDate, @Date drop table #tmp;",
  "v2_SuaPhongBan": "-- thêm mới cơ quan update  DM_CoQuan set TenCoQuan=@TenCoQuan where CoQuanID = @CoQuanID",
  "v2_ThemMoiPhongBan": "-- thêm mới cơ quan INSERT INTO  DM_CoQuan ( TenCoQuan, CoQuanChaID, CQCoHieuLuc, CoQuanSuDungPhanMemID ) VALUES( @TenCoQuan, @CoQuanChaID, 1, @CoQuanChaID ); --select SCOPE_IDENTITY(); -- thêm mới nhóm người dùng cho cơ quan declare @CoQuanID int set @CoQuanID = SCOPE_IDENTITY() insert into  HT_NhomNguoiDung (TenNhom, CoQuanID, NhomTongID) (select TenNhom, @CoQuanID, NhomTongID from  HT_NhomNguoiDung where coquanid = @CoQuanChaID) -- thêm mới chức năng cho nhóm người dùng insert into  HT_PhanQuyen (NhomNguoiDungID, ChucNangID, Quyen) ( select n1.NhomNguoiDungID, n2.ChucNangID, n2.Quyen from (select * from ht_nhomnguoidung where coquanid=@CoQuanID) as n1 join (select nnd.NhomNguoiDungID, ChucNangID, Quyen, nnd.NhomTongID from HT_PhanQuyen pq join  HT_NhomNguoiDung nnd on nnd.NhomNguoiDungID = pq.NhomNguoiDungID and nnd.CoQuanID= @CoQuanChaID) as n2 on n1.NhomTongID = n2.nhomtongid ) select @CoQuanID --select n1.NhomNguoiDungID, n2.ChucNangID, n2.Quyen from --(select * from ht_nhomnguoidung where coquanid=86) as n1 --join --(select nnd.NhomNguoiDungID, ChucNangID, Quyen, nnd.NhomTongID from HT_PhanQuyen pq --join  HT_NhomNguoiDung nnd on nnd.NhomNguoiDungID = pq.NhomNguoiDungID and nnd.CoQuanID= 83) as n2 --on n1.NhomTongID = n2.nhomtongid --select nnd.NhomNguoiDungID, pq.ChucNangID, pq.Quyen from ht_nhomnguoidung nnd --join  HT_PhanQuyen pq on pq.NhomNguoiDungID = nnd.NhomNguoiDungID -- where coquanid=86 --select * from ht_nhomnguoidung where coquanid=86 --select nnd.NhomNguoiDungID, ChucNangID, Quyen, nnd.NhomTongID from HT_PhanQuyen pq --join  HT_NhomNguoiDung nnd on nnd.NhomNguoiDungID = pq.NhomNguoiDungID and nnd.CoQuanID= 83",
  "v2_XoaPhongBan": "-- xoá phân quyền cho người dùng delete from  HT_NguoiDung_NhomNguoiDung where NguoiDungID in (select NguoiDungID from  HT_NguoiDung nd join  ht_canbo cb on cb.canboid = nd.CanBoID where cb.CoQuanID=@CoQuanID) -- xoá người dùng delete from  HT_nguoidung where NguoiDungID in (select NguoiDungID from  HT_NguoiDung nd join  ht_canbo cb on cb.canboid = nd.CanBoID where cb.CoQuanID=@CoQuanID) -- xoá cán bộ delete from  HT_CanBo where CoQuanID=@CoQuanID -- xoá phân quyền cho nhóm người dùng của phòng ban delete from  HT_PhanQuyen where NhomNguoiDungID in (select NhomNguoiDungID from  HT_NhomNguoiDung where CoQuanID= @CoQuanID) -- xoá nhóm người dùng của phòng ban delete from  HT_NhomNguoiDung where CoQuanID= @CoQuanID -- xoá phòng ban delete from  DM_CoQuan where coquanid = @CoQuanID",
  "v4_CapNhatFaceID": "UPDATE  HT_CanBo SET FaceID = @FaceID WHERE CanBoID = @CanBoID;",
  "v4_HeThong_CanBo_GetByID": "select*from  HT_CanBo cb left join  HT_NguoiDung nd on cb.CanBoID = nd.CanBoID where cb.CanBoID = @CanBoID",
  "v4_NV_FileDinhKemAnh_UpdateFeatureID": "UPDATE NV_FileDinhKem SET FeatureID = @FeatureID WHERE FileDinhKemID = @FileDinhKemID;",
  "v4_NV_ThongTinVaoRa_GetBy_ThongTinKhachID": "--select * from  NV_ThongTinVaoRa vr --left join  NV_FileDinhKem f on f.ThongTinVaoRaID= vr.ThongTinVaoRaID --where ThongTinKhachID = @ThongTinKhachID -- and (GioRa_Int=0 or GioRa_Int is null) -- and vr.LaCanBo=@LaCanBo -- and vr.DonViSuDungID=@DonViSuDungID --order by GioVao desc select * from  NV_ThongTinVaoRa vr left join  NV_FileDinhKem f on f.ThongTinVaoRaID= vr.ThongTinVaoRaID where ThongTinKhachID = @ThongTinKhachID --and (GioRa_Int=0 or GioRa_Int is null) and vr.LaCanBo=@LaCanBo and vr.DonViSuDungID=@DonViSuDungID order by vr.ThongTinVaoRaID desc",
  "v4_NV_ThongTinVaoRa_Insert": "INSERT INTO  NV_ThongTinVaoRa ( GioVao, GapCanBo, LeTan_Vao , MaThe, HoVaTen, NgaySinh , HoKhau , DienThoai , SoCMND , NoiCapCMND , NgayCapCMND ,TenCoQuan , DonViSuDungID , ThanNhiet , DonViCaNhan , GioiTinh , LoaiGiayTo , LyDoGap , ThongTinKhachID , LaCanBo ) VALUEs ( @GioVao, @GapCanBo, @LeTan_Vao, @MaTheTuNhap, @HoVaTen , @NgaySinh , @HoKhau , @DienThoai , @SoCMND , @NoiCapCMND , @NgayCapCMND ,@TenCoQuan , @DonViSuDungID , @ThanNhiet , @DonViCaNhan , @GioiTinh , @LoaiGiayTo , @LyDoGap , @ThongTinKhachID , @LaCanBo ); SELECT last_insert_rowid();",
  "v4_NV_ThongTinVaoRa_Insert_New": "INSERT INTO NV_ThongTinVaoRa ( GioVao, GapCanBo, LeTan_Vao , MaThe, HoVaTen, NgaySinh , HoKhau , DienThoai , SoCMND , NoiCapCMND , NgayCapCMND ,TenCoQuan , DonViSuDungID , ThanNhiet , DonViCaNhan , GioiTinh , LoaiGiayTo , LyDoGap , ThongTinKhachID , LaCanBo , LyDoKhac, GioVao_Int, GioRa_Int ) VALUEs ( @GioVao, @GapCanBo, @LeTan_Vao, @MaTheTuNhap, @HoVaTen , @NgaySinh , @HoKhau , @DienThoai , @SoCMND , @NoiCapCMND , @NgayCapCMND ,@TenCoQuan , @DonViSuDungID , @ThanNhiet , @DonViCaNhan , @GioiTinh , @LoaiGiayTo , @LyDoGap , @ThongTinKhachID , @LaCanBo , @LyDoKhac, @GioVao_Int, 0 ); SELECT last_insert_rowid();",
  "v4_NV_TruyVetYTe_ToanTinh": "declare @startDate int declare @Date int set @startDate=IIF(@TuNgay is null, 0,  ConvertDateToInt(@TuNgay)) set @Date=IIF(@DenNgay is null, 0,  ConvertDateToInt(@DenNgay)) -- lấy danh sách gặp cán bộ select vr.*, vr.TenCoQuan as NoiCongTac, cbgap.TenCanBo as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap, (select top 1 TenFileHeThong from NV_FileDinhKem where ThongTinVaoRaID = vr.ThongTinVaoRaID and LoaiFile = 3) as FileUrl, (select top 1 TenFileHeThong from NV_FileDinhKem where ThongTinVaoRaID = vr.ThongTinVaoRaID and LoaiFile = 1) as AnhCMND_MT into #tmp from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  HT_CanBo cbgap on cbgap.CanBoID = vr.GapCanBo and vr.DonViCaNhan=2 join  DM_CoQuan cqGap on cqGap.CoQuanID= cbgap.CoQuanID where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@TinhID is null or @TinhID =0 or cqGap.TinhID=@TinhID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) -- lấy danh sách gắp cơ quan insert into #tmp select vr.*, vr.TenCoQuan as NoiCongTac, '' as TenCanBoGap, cqGap.CoQuanID as GapBoPhanID, cqGap.TenCoQuan as TenBoPhanGap, (select top 1 TenFileHeThong from NV_FileDinhKem where ThongTinVaoRaID = vr.ThongTinVaoRaID and LoaiFile = 3) as FileUrl, (select top 1 TenFileHeThong from NV_FileDinhKem where ThongTinVaoRaID = vr.ThongTinVaoRaID and LoaiFile = 1) as AnhCMND_MT from  NV_ThongTinVaoRa vr left join  HT_CanBo letan on letan.CanBoID= vr.LeTan_Vao join  DM_CoQuan cqGap on cqGap.CoQuanID= vr.GapCanBo and DonViCaNhan =1 where (@TuNgay is null or vr.GioVao_Int >=@startDate) and (@DenNgay is null or vr.GioVao_Int <=@Date) and (@TinhID is null or @TinhID =0 or cqGap.TinhID=@TinhID) and (@Keyword is null or @Keyword='' or vr.HoVaTen like CONCAT('%',@Keyword,'%') or vr.SoCMND = cast(@Keyword as varchar(20)) or vr.DienThoai = cast(@Keyword as varchar(20))) select * from #tmp order by GioVao desc set @TotalRow =(SELECT COUNT(1) FROM #tmp); select @TuNgay, @DenNgay, @startDate, @Date drop table #tmp;",
  "v4_NV_TruyVetYTe_TrongDonVi": "WITH cte AS (
    SELECT 
        vr.*,
        vr.TenCoQuan AS NoiCongTac,
        CASE 
            WHEN vr.DonViCaNhan = 2 THEN cbgap.TenCanBo 
            ELSE '' 
        END AS TenCanBoGap,
        CASE 
            WHEN vr.DonViCaNhan = 2 THEN cqGap1.CoQuanID 
            ELSE cqGap2.CoQuanID 
        END AS GapBoPhanID,
        CASE 
            WHEN vr.DonViCaNhan = 2 THEN cqGap1.TenCoQuan 
            ELSE cqGap2.TenCoQuan 
        END AS TenBoPhanGap,
        (SELECT TenFileHeThong 
         FROM NV_FileDinhKem 
         WHERE ThongTinVaoRaID = vr.ThongTinVaoRaID 
           AND LoaiFile = 3 
         LIMIT 1) AS FileUrl,
        (SELECT TenFileHeThong 
         FROM NV_FileDinhKem 
         WHERE ThongTinVaoRaID = vr.ThongTinVaoRaID 
           AND LoaiFile = 1 
         LIMIT 1) AS AnhCMND_MT
    FROM NV_ThongTinVaoRa vr
    LEFT JOIN HT_CanBo letan ON letan.CanBoID = vr.LeTan_Vao
    LEFT JOIN HT_CanBo cbgap ON cbgap.CanBoID = vr.GapCanBo AND vr.DonViCaNhan = 2
    LEFT JOIN DM_CoQuan cqGap1 ON cqGap1.CoQuanID = cbgap.CoQuanID AND vr.DonViCaNhan = 2
    LEFT JOIN DM_CoQuan cqGap2 ON cqGap2.CoQuanID = vr.GapCanBo AND vr.DonViCaNhan = 1
    WHERE 
        (@TuNgay IS NULL OR vr.GioVao_Int >= @TuNgay) AND
        (@DenNgay IS NULL OR vr.GioVao_Int <= @DenNgay) AND
        (@DonViSuDungID = 0 OR vr.DonViSuDungID = @DonViSuDungID) AND
        (
            @Keyword = '' OR
            vr.HoVaTen LIKE '%' || @Keyword || '%' OR
            vr.SoCMND = @Keyword OR
            vr.DienThoai = @Keyword
        )
)
SELECT 
    cte.*,
    (SELECT COUNT(*) FROM cte) AS TotalRow
FROM cte
ORDER BY GioVao DESC;",
  "v4_ThongTinKhach_GetByID": "select * from NV_ThongTinKhach where ThongTinKhachID = @ThongTinKhachID;",
  "v4_ThongTinKhach_Insert": "INSERT INTO NV_ThongTinKhach ( HoVaTen, NgaySinh , GioiTinh , HoKhau , DienThoai, SoCMND , NoiCapCMND, NgayCapCMND ) VALUES ( @HoVaTen, @NgaySinh , @GioiTinh , @HoKhau , @DienThoai, @SoCMND , @NoiCapCMND, @NgayCapCMND ); SELECT last_insert_rowid();",
  "v4_ThongTinKhach_Update": "update NV_ThongTinKhach set HoVaTen = @HoVaTen, NgaySinh = @NgaySinh, GioiTinh = @GioiTinh, HoKhau = @HoKhau, DienThoai = @DienThoai, SoCMND = @SoCMND, NoiCapCMND = @NoiCapCMND, NgayCapCMND = @NgayCapCMND where ThongTinKhachID = @ThongTinKhachID",
  "v4_ThongTinKhach_UpdateFaceID": "UPDATE NV_ThongTinKhach SET FaceID = @FaceID WHERE ThongTinKhachID = @ThongTinKhachID;",
  "sp_GetAllTinh": "SELECT * FROM DM_Tinh"
}